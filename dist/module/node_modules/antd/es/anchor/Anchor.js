import"/node_modules/core-js/modules/es.array.index-of.js";import"/node_modules/core-js/modules/es.array.reduce.js";import"/node_modules/core-js/modules/es.array.splice.js";import"/node_modules/core-js/modules/es.regexp.to-string.js";import"/node_modules/core-js/modules/es.string.includes.js";import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _classCallCheck from"/node_modules/@babel/runtime/helpers/esm/classCallCheck.js";import _createClass from"/node_modules/@babel/runtime/helpers/esm/createClass.js";import _assertThisInitialized from"/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js";import _inherits from"/node_modules/@babel/runtime/helpers/esm/inherits.js";import _createSuper from"/node_modules/@babel/runtime/helpers/esm/createSuper.js";import React from"c:\\node_modules\\react\\index.js";import classNames from"/node_modules/classnames.js";import addEventListener from"/node_modules/rc-util/es/Dom/addEventListener.js";import Affix from"/node_modules/antd/es/affix.js";import{ConfigContext}from"/node_modules/antd/es/config-provider.js";import scrollTo from"/node_modules/antd/es/_util/scrollTo.js";import getScroll from"/node_modules/antd/es/_util/getScroll.js";import AnchorContext from"/node_modules/antd/es/anchor/context.js";function getDefaultContainer(){return window}function getOffsetTop(element,container){if(!element.getClientRects().length)return 0;var rect=element.getBoundingClientRect();return rect.width||rect.height?container===window?(container=element.ownerDocument.documentElement,rect.top-container.clientTop):rect.top-container.getBoundingClientRect().top:rect.top}var sharpMatcherRegx=/#(\S+)$/,Anchor=function(_React$Component){function Anchor(){var _this;return _classCallCheck(this,Anchor),_this=_super.apply(this,arguments),_this.state={activeLink:null},_this.wrapperRef=React.createRef(),_this.links=[],_this.registerLink=function(link){_this.links.includes(link)||_this.links.push(link)},_this.unregisterLink=function(link){var index=_this.links.indexOf(link);-1!==index&&_this.links.splice(index,1)},_this.getContainer=function(){var getTargetContainer=_this.context.getTargetContainer,getContainer=_this.props.getContainer;return(getContainer||getTargetContainer||getDefaultContainer)()},_this.handleScrollTo=function(link){var _this$props=_this.props,offsetTop=_this$props.offsetTop,targetOffset=_this$props.targetOffset;_this.setCurrentActiveLink(link);var container=_this.getContainer(),scrollTop=getScroll(container,!0),sharpLinkMatch=sharpMatcherRegx.exec(link);if(sharpLinkMatch){var targetElement=document.getElementById(sharpLinkMatch[1]);if(targetElement){var eleOffsetTop=getOffsetTop(targetElement,container),y=scrollTop+eleOffsetTop;y-=void 0===targetOffset?offsetTop||0:targetOffset,_this.animating=!0,scrollTo(y,{callback:function callback(){_this.animating=!1},getContainer:_this.getContainer})}}},_this.saveInkNode=function(node){_this.inkNode=node},_this.setCurrentActiveLink=function(link){var activeLink=_this.state.activeLink,onChange=_this.props.onChange;activeLink!==link&&(_this.setState({activeLink:link}),onChange&&onChange(link))},_this.handleScroll=function(){if(!_this.animating){var _this$props2=_this.props,offsetTop=_this$props2.offsetTop,bounds=_this$props2.bounds,targetOffset=_this$props2.targetOffset,currentActiveLink=_this.getCurrentAnchor(void 0===targetOffset?offsetTop||0:targetOffset,bounds);_this.setCurrentActiveLink(currentActiveLink)}},_this.updateInk=function(){var _assertThisInitialize=_assertThisInitialized(_this),prefixCls=_assertThisInitialize.prefixCls,wrapperRef=_assertThisInitialize.wrapperRef,anchorNode=wrapperRef.current,linkNode=null===anchorNode||void 0===anchorNode?void 0:anchorNode.getElementsByClassName("".concat(prefixCls,"-link-title-active"))[0];linkNode&&(_this.inkNode.style.top="".concat(linkNode.offsetTop+linkNode.clientHeight/2-4.5,"px"))},_this.render=function(){var _this$context=_this.context,getPrefixCls=_this$context.getPrefixCls,direction=_this$context.direction,_this$props3=_this.props,customizePrefixCls=_this$props3.prefixCls,_this$props3$classNam=_this$props3.className,className=void 0===_this$props3$classNam?"":_this$props3$classNam,style=_this$props3.style,offsetTop=_this$props3.offsetTop,affix=_this$props3.affix,showInkInFixed=_this$props3.showInkInFixed,children=_this$props3.children,activeLink=_this.state.activeLink,prefixCls=getPrefixCls("anchor",customizePrefixCls);_this.prefixCls=prefixCls;var inkClass=classNames("".concat(prefixCls,"-ink-ball"),{visible:activeLink}),wrapperClass=classNames("".concat(prefixCls,"-wrapper"),_defineProperty({},"".concat(prefixCls,"-rtl"),"rtl"===direction),className),anchorClass=classNames(prefixCls,{fixed:!affix&&!showInkInFixed}),wrapperStyle=_extends({maxHeight:offsetTop?"calc(100vh - ".concat(offsetTop,"px)"):"100vh"},style),anchorContent=React.createElement("div",{ref:_this.wrapperRef,className:wrapperClass,style:wrapperStyle},React.createElement("div",{className:anchorClass},React.createElement("div",{className:"".concat(prefixCls,"-ink")},React.createElement("span",{className:inkClass,ref:_this.saveInkNode})),children));return React.createElement(AnchorContext.Provider,{value:{registerLink:_this.registerLink,unregisterLink:_this.unregisterLink,activeLink:_this.state.activeLink,scrollTo:_this.handleScrollTo,onClick:_this.props.onClick}},affix?React.createElement(Affix,{offsetTop:offsetTop,target:_this.getContainer},anchorContent):anchorContent)},_this}_inherits(Anchor,_React$Component);var _super=_createSuper(Anchor);return _createClass(Anchor,[{key:"componentDidMount",value:function componentDidMount(){this.scrollContainer=this.getContainer(),this.scrollEvent=addEventListener(this.scrollContainer,"scroll",this.handleScroll),this.handleScroll()}},{key:"componentDidUpdate",value:function componentDidUpdate(){if(this.scrollEvent){var currentContainer=this.getContainer();this.scrollContainer!==currentContainer&&(this.scrollContainer=currentContainer,this.scrollEvent.remove(),this.scrollEvent=addEventListener(this.scrollContainer,"scroll",this.handleScroll),this.handleScroll())}this.updateInk()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.scrollEvent&&this.scrollEvent.remove()}},{key:"getCurrentAnchor",value:function getCurrentAnchor(){var offsetTop=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,bounds=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5,getCurrentAnchor=this.props.getCurrentAnchor;if("function"==typeof getCurrentAnchor)return getCurrentAnchor();var linkSections=[],container=this.getContainer();if(this.links.forEach(function(link){var sharpLinkMatch=sharpMatcherRegx.exec(link.toString());if(sharpLinkMatch){var target=document.getElementById(sharpLinkMatch[1]);if(target){var top=getOffsetTop(target,container);top<offsetTop+bounds&&linkSections.push({link:link,top:top})}}}),linkSections.length){var maxSection=linkSections.reduce(function(prev,curr){return curr.top>prev.top?curr:prev});return maxSection.link}return""}}]),Anchor}(React.Component);export{Anchor as default};Anchor.defaultProps={affix:!0,showInkInFixed:!1},Anchor.contextType=ConfigContext;