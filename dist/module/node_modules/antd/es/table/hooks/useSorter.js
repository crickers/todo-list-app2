import"/node_modules/core-js/modules/es.array.index-of.js";import"/node_modules/core-js/modules/es.array.slice.js";import"/node_modules/core-js/modules/es.array.sort.js";import"/node_modules/core-js/modules/es.string.includes.js";import _slicedToArray from"/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _toConsumableArray from"/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import _typeof from"/node_modules/@babel/runtime/helpers/esm/typeof.js";import React from"c:\\node_modules\\react\\index.js";import classNames from"/node_modules/classnames.js";import CaretDownOutlined from"/node_modules/@ant-design/icons/es/icons/CaretDownOutlined.js";import CaretUpOutlined from"/node_modules/@ant-design/icons/es/icons/CaretUpOutlined.js";import Tooltip from"/node_modules/antd/es/tooltip.js";import{getColumnKey,getColumnPos,renderColumnTitle}from"/node_modules/antd/es/table/util.js";var ASCEND="ascend",DESCEND="descend";function getMultiplePriority(column){return!("object"!==_typeof(column.sorter)||"number"!=typeof column.sorter.multiple)&&column.sorter.multiple}function getSortFunction(sorter){return"function"==typeof sorter?sorter:!!(sorter&&"object"===_typeof(sorter)&&sorter.compare)&&sorter.compare}function nextSortDirection(sortDirections,current){return current?sortDirections[sortDirections.indexOf(current)+1]:sortDirections[0]}function collectSortStates(columns,init,pos){function pushState(column,columnPos){sortStates.push({column:column,key:getColumnKey(column,columnPos),multiplePriority:getMultiplePriority(column),sortOrder:column.sortOrder})}var sortStates=[];return(columns||[]).forEach(function(column,index){var columnPos=getColumnPos(index,pos);column.children?("sortOrder"in column&&pushState(column,columnPos),sortStates=[].concat(_toConsumableArray(sortStates),_toConsumableArray(collectSortStates(column.children,init,columnPos)))):column.sorter&&("sortOrder"in column?pushState(column,columnPos):init&&column.defaultSortOrder&&sortStates.push({column:column,key:getColumnKey(column,columnPos),multiplePriority:getMultiplePriority(column),sortOrder:column.defaultSortOrder}))}),sortStates}function injectSorter(prefixCls,columns,sorterSates,triggerSorter,defaultSortDirections,tableLocale,tableShowSorterTooltip,pos){return(columns||[]).map(function(column,index){var columnPos=getColumnPos(index,pos),newColumn=column;if(newColumn.sorter){var sortDirections=newColumn.sortDirections||defaultSortDirections,showSorterTooltip=void 0===newColumn.showSorterTooltip?tableShowSorterTooltip:newColumn.showSorterTooltip,columnKey=getColumnKey(newColumn,columnPos),sorterState=sorterSates.find(function(_ref){var key=_ref.key;return key===columnKey}),sorterOrder=sorterState?sorterState.sortOrder:null,nextSortOrder=nextSortDirection(sortDirections,sorterOrder),upNode=sortDirections.includes(ASCEND)&&React.createElement(CaretUpOutlined,{className:classNames("".concat(prefixCls,"-column-sorter-up"),{active:sorterOrder===ASCEND})}),downNode=sortDirections.includes(DESCEND)&&React.createElement(CaretDownOutlined,{className:classNames("".concat(prefixCls,"-column-sorter-down"),{active:sorterOrder===DESCEND})}),_ref2=tableLocale||{},cancelSort=_ref2.cancelSort,triggerAsc=_ref2.triggerAsc,triggerDesc=_ref2.triggerDesc,sortTip=cancelSort;nextSortOrder===DESCEND?sortTip=triggerDesc:nextSortOrder===ASCEND&&(sortTip=triggerAsc),newColumn=_extends(_extends({},newColumn),{className:classNames(newColumn.className,_defineProperty({},"".concat(prefixCls,"-column-sort"),sorterOrder)),title:function title(renderProps){var renderSortTitle=React.createElement("div",{className:"".concat(prefixCls,"-column-sorters")},React.createElement("span",null,renderColumnTitle(column.title,renderProps)),React.createElement("span",{className:classNames("".concat(prefixCls,"-column-sorter"),_defineProperty({},"".concat(prefixCls,"-column-sorter-full"),upNode&&downNode))},React.createElement("span",{className:"".concat(prefixCls,"-column-sorter-inner")},upNode,downNode)));return showSorterTooltip?React.createElement(Tooltip,{title:sortTip},React.createElement("div",{className:"".concat(prefixCls,"-column-sorters-with-tooltip")},renderSortTitle)):renderSortTitle},onHeaderCell:function onHeaderCell(col){var cell=column.onHeaderCell&&column.onHeaderCell(col)||{},originOnClick=cell.onClick;return cell.onClick=function(event){triggerSorter({column:column,key:columnKey,sortOrder:nextSortOrder,multiplePriority:getMultiplePriority(column)}),originOnClick&&originOnClick(event)},cell.className=classNames(cell.className,"".concat(prefixCls,"-column-has-sorters")),cell}})}return"children"in newColumn&&(newColumn=_extends(_extends({},newColumn),{children:injectSorter(prefixCls,newColumn.children,sorterSates,triggerSorter,defaultSortDirections,tableLocale,tableShowSorterTooltip,columnPos)})),newColumn})}function stateToInfo(sorterStates){var column=sorterStates.column,sortOrder=sorterStates.sortOrder;return{column:column,order:sortOrder,field:column.dataIndex,columnKey:column.key}}function generateSorterInfo(sorterStates){var list=sorterStates.filter(function(_ref3){var sortOrder=_ref3.sortOrder;return sortOrder}).map(stateToInfo);return 0===list.length&&sorterStates.length?_extends(_extends({},stateToInfo(sorterStates[sorterStates.length-1])),{column:void 0}):1>=list.length?list[0]||{}:list}export function getSortData(data,sortStates,childrenColumnName){var innerSorterStates=sortStates.slice().sort(function(a,b){return b.multiplePriority-a.multiplePriority}),cloneData=data.slice(),runningSorters=innerSorterStates.filter(function(_ref4){var sorter=_ref4.column.sorter,sortOrder=_ref4.sortOrder;return getSortFunction(sorter)&&sortOrder});return runningSorters.length?cloneData.sort(function(record1,record2){for(var i=0;i<runningSorters.length;i+=1){var sorterState=runningSorters[i],sorter=sorterState.column.sorter,sortOrder=sorterState.sortOrder,compareFn=getSortFunction(sorter);if(compareFn&&sortOrder){var compareResult=compareFn(record1,record2,sortOrder);if(0!==compareResult)return sortOrder===ASCEND?compareResult:-compareResult}}return 0}).map(function(record){var subRecords=record[childrenColumnName];return subRecords?_extends(_extends({},record),_defineProperty({},childrenColumnName,getSortData(subRecords,sortStates,childrenColumnName))):record}):cloneData}export default function useFilterSorter(_ref5){function triggerSorter(sortState){var newSorterStates;newSorterStates=!1!==sortState.multiplePriority&&mergedSorterStates.length&&!1!==mergedSorterStates[0].multiplePriority?[].concat(_toConsumableArray(mergedSorterStates.filter(function(_ref7){var key=_ref7.key;return key!==sortState.key})),[sortState]):[sortState],setSortStates(newSorterStates),onSorterChange(generateSorterInfo(newSorterStates),newSorterStates)}var prefixCls=_ref5.prefixCls,mergedColumns=_ref5.mergedColumns,onSorterChange=_ref5.onSorterChange,sortDirections=_ref5.sortDirections,tableLocale=_ref5.tableLocale,showSorterTooltip=_ref5.showSorterTooltip,_React$useState=React.useState(collectSortStates(mergedColumns,!0)),_React$useState2=_slicedToArray(_React$useState,2),sortStates=_React$useState2[0],setSortStates=_React$useState2[1],mergedSorterStates=React.useMemo(function(){function patchStates(state){validate?validateStates.push(state):validateStates.push(_extends(_extends({},state),{sortOrder:null}))}var validate=!0,collectedStates=collectSortStates(mergedColumns,!1);if(!collectedStates.length)return sortStates;var validateStates=[],multipleMode=null;return collectedStates.forEach(function(state){null===multipleMode?(patchStates(state),state.sortOrder&&(!1===state.multiplePriority?validate=!1:multipleMode=!0)):multipleMode&&!1!==state.multiplePriority?patchStates(state):(validate=!1,patchStates(state))}),validateStates},[mergedColumns,sortStates]),columnTitleSorterProps=React.useMemo(function(){var sortColumns=mergedSorterStates.map(function(_ref6){var column=_ref6.column,sortOrder=_ref6.sortOrder;return{column:column,order:sortOrder}});return{sortColumns:sortColumns,sortColumn:sortColumns[0]&&sortColumns[0].column,sortOrder:sortColumns[0]&&sortColumns[0].order}},[mergedSorterStates]);return[function transformColumns(innerColumns){return injectSorter(prefixCls,innerColumns,mergedSorterStates,triggerSorter,sortDirections,tableLocale,showSorterTooltip)},mergedSorterStates,columnTitleSorterProps,function getSorters(){return generateSorterInfo(mergedSorterStates)}]}