import"/node_modules/core-js/modules/es.array.index-of.js";import"/node_modules/core-js/modules/es.array.slice.js";import"/node_modules/core-js/modules/es.object.assign.js";import"/node_modules/core-js/modules/es.string.split.js";import _objectWithoutProperties from"/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js";import _objectSpread from"/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import _classCallCheck from"/node_modules/@babel/runtime/helpers/esm/classCallCheck.js";import _createClass from"/node_modules/@babel/runtime/helpers/esm/createClass.js";import _inherits from"/node_modules/@babel/runtime/helpers/esm/inherits.js";import _createSuper from"/node_modules/@babel/runtime/helpers/esm/createSuper.js";import classNames from"/node_modules/classnames.js";import toArray from"/node_modules/rc-util/es/Children/toArray.js";import KeyCode from"/node_modules/rc-util/es/KeyCode.js";import React from"c:\\node_modules\\react\\index.js";import TextArea from"/node_modules/rc-textarea.js";import KeywordTrigger from"/node_modules/rc-mentions/es/KeywordTrigger.js";import{MentionsContextProvider}from"/node_modules/rc-mentions/es/MentionsContext.js";import Option from"/node_modules/rc-mentions/es/Option.js";import{filterOption as defaultFilterOption,getBeforeSelectionText,getLastMeasureIndex,omit,replaceWithMeasure,setInputSelection,validateSearch as defaultValidateSearch}from"/node_modules/rc-mentions/es/util.js";var Mentions=function(_React$Component){function Mentions(props){var _this;return _classCallCheck(this,Mentions),_this=_super.call(this,props),_this.focusId=void 0,_this.triggerChange=function(value){var onChange=_this.props.onChange;"value"in _this.props||_this.setState({value:value}),onChange&&onChange(value)},_this.onChange=function(_ref){var value=_ref.target.value;_this.triggerChange(value)},_this.onKeyDown=function(event){var which=event.which,_this$state=_this.state,activeIndex=_this$state.activeIndex,measuring=_this$state.measuring;if(measuring)if(which===KeyCode.UP||which===KeyCode.DOWN){var optionLen=_this.getOptions().length,offset=which===KeyCode.UP?-1:1;_this.setState({activeIndex:(activeIndex+offset+optionLen)%optionLen}),event.preventDefault()}else if(which===KeyCode.ESC)_this.stopMeasure();else if(which===KeyCode.ENTER){event.preventDefault();var options=_this.getOptions();if(!options.length)return void _this.stopMeasure();var option=options[activeIndex];_this.selectOption(option)}},_this.onKeyUp=function(event){var key=event.key,which=event.which,_this$state2=_this.state,prevMeasureText=_this$state2.measureText,measuring=_this$state2.measuring,_this$props=_this.props,_this$props$prefix=_this$props.prefix,prefix=void 0===_this$props$prefix?"":_this$props$prefix,onSearch=_this$props.onSearch,validateSearch=_this$props.validateSearch,target=event.target,selectionStartText=getBeforeSelectionText(target),_getLastMeasureIndex=getLastMeasureIndex(selectionStartText,prefix),measureIndex=_getLastMeasureIndex.location,measurePrefix=_getLastMeasureIndex.prefix;if(-1===[KeyCode.ESC,KeyCode.UP,KeyCode.DOWN,KeyCode.ENTER].indexOf(which))if(-1!==measureIndex){var measureText=selectionStartText.slice(measureIndex+measurePrefix.length),validateMeasure=validateSearch(measureText,_this.props),matchOption=!!_this.getOptions(measureText).length;validateMeasure?(key===measurePrefix||"Shift"===key||measuring||measureText!==prevMeasureText&&matchOption)&&_this.startMeasure(measureText,measurePrefix,measureIndex):measuring&&_this.stopMeasure(),onSearch&&validateMeasure&&onSearch(measureText,measurePrefix)}else measuring&&_this.stopMeasure()},_this.onPressEnter=function(event){var measuring=_this.state.measuring,onPressEnter=_this.props.onPressEnter;!measuring&&onPressEnter&&onPressEnter(event)},_this.onInputFocus=function(event){_this.onFocus(event)},_this.onInputBlur=function(event){_this.onBlur(event)},_this.onDropdownFocus=function(){_this.onFocus()},_this.onDropdownBlur=function(){_this.onBlur()},_this.onFocus=function(event){window.clearTimeout(_this.focusId);var isFocus=_this.state.isFocus,onFocus=_this.props.onFocus;!isFocus&&event&&onFocus&&onFocus(event),_this.setState({isFocus:!0})},_this.onBlur=function(event){_this.focusId=window.setTimeout(function(){var onBlur=_this.props.onBlur;_this.setState({isFocus:!1}),_this.stopMeasure(),onBlur&&onBlur(event)},0)},_this.selectOption=function(option){var _this$state3=_this.state,value=_this$state3.value,measureLocation=_this$state3.measureLocation,measurePrefix=_this$state3.measurePrefix,_this$props2=_this.props,split=_this$props2.split,onSelect=_this$props2.onSelect,_option$value=option.value,mentionValue=void 0===_option$value?"":_option$value,_replaceWithMeasure=replaceWithMeasure(value,{measureLocation:measureLocation,targetText:mentionValue,prefix:measurePrefix,selectionStart:_this.textarea.selectionStart,split:split}),text=_replaceWithMeasure.text,selectionLocation=_replaceWithMeasure.selectionLocation;_this.triggerChange(text),_this.stopMeasure(function(){setInputSelection(_this.textarea,selectionLocation)}),onSelect&&onSelect(option,measurePrefix)},_this.setActiveIndex=function(activeIndex){_this.setState({activeIndex:activeIndex})},_this.setTextAreaRef=function(element){var _element$resizableTex;_this.textarea=null===element||void 0===element||null===(_element$resizableTex=element.resizableTextArea)||void 0===_element$resizableTex?void 0:_element$resizableTex.textArea},_this.setMeasureRef=function(element){_this.measure=element},_this.getOptions=function(measureText){var targetMeasureText=measureText||_this.state.measureText||"",_this$props3=_this.props,children=_this$props3.children,filterOption=_this$props3.filterOption,list=toArray(children).map(function(_ref2){var props=_ref2.props,key=_ref2.key;return _objectSpread(_objectSpread({},props),{},{key:key||props.value})}).filter(function(option){return!1===filterOption||filterOption(targetMeasureText,option)});return list},_this.state={value:props.defaultValue||props.value||"",measuring:!1,measureLocation:0,measureText:null,measurePrefix:"",activeIndex:0,isFocus:!1},_this}_inherits(Mentions,_React$Component);var _super=_createSuper(Mentions);return _createClass(Mentions,[{key:"componentDidUpdate",value:function componentDidUpdate(){var measuring=this.state.measuring;measuring&&(this.measure.scrollTop=this.textarea.scrollTop)}},{key:"startMeasure",value:function startMeasure(measureText,measurePrefix,measureLocation){this.setState({measuring:!0,measureText:measureText,measurePrefix:measurePrefix,measureLocation:measureLocation,activeIndex:0})}},{key:"stopMeasure",value:function stopMeasure(callback){this.setState({measuring:!1,measureLocation:0,measureText:null},callback)}},{key:"focus",value:function focus(){this.textarea.focus()}},{key:"blur",value:function blur(){this.textarea.blur()}},{key:"render",value:function render(){var _this$state4=this.state,value=_this$state4.value,measureLocation=_this$state4.measureLocation,measurePrefix=_this$state4.measurePrefix,measuring=_this$state4.measuring,activeIndex=_this$state4.activeIndex,_this$props4=this.props,prefixCls=_this$props4.prefixCls,placement=_this$props4.placement,direction=_this$props4.direction,transitionName=_this$props4.transitionName,className=_this$props4.className,style=_this$props4.style,autoFocus=_this$props4.autoFocus,notFoundContent=_this$props4.notFoundContent,getPopupContainer=_this$props4.getPopupContainer,restProps=_objectWithoutProperties(_this$props4,["prefixCls","placement","direction","transitionName","className","style","autoFocus","notFoundContent","getPopupContainer"]),inputProps=omit(restProps,"value","defaultValue","prefix","split","children","validateSearch","filterOption","onSelect","onSearch"),options=measuring?this.getOptions():[];return React.createElement("div",{className:classNames(prefixCls,className),style:style},React.createElement(TextArea,Object.assign({autoFocus:autoFocus,ref:this.setTextAreaRef,value:value},inputProps,{onChange:this.onChange,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onPressEnter:this.onPressEnter,onFocus:this.onInputFocus,onBlur:this.onInputBlur})),measuring&&React.createElement("div",{ref:this.setMeasureRef,className:"".concat(prefixCls,"-measure")},value.slice(0,measureLocation),React.createElement(MentionsContextProvider,{value:{notFoundContent:notFoundContent,activeIndex:activeIndex,setActiveIndex:this.setActiveIndex,selectOption:this.selectOption,onFocus:this.onDropdownFocus,onBlur:this.onDropdownBlur}},React.createElement(KeywordTrigger,{prefixCls:prefixCls,transitionName:transitionName,placement:placement,direction:direction,options:options,visible:!0,getPopupContainer:getPopupContainer},React.createElement("span",null,measurePrefix))),value.slice(measureLocation+measurePrefix.length)))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,prevState){var newState={};return"value"in props&&props.value!==prevState.value&&(newState.value=props.value||""),newState}}]),Mentions}(React.Component);Mentions.Option=Option,Mentions.defaultProps={prefixCls:"rc-mentions",prefix:"@",split:" ",validateSearch:defaultValidateSearch,filterOption:defaultFilterOption,notFoundContent:"Not Found",rows:1};export default Mentions;