import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _objectSpread from"/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import _slicedToArray from"/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _objectWithoutProperties from"/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js";import React from"c:\\node_modules\\react\\index.js";import useForm from"/node_modules/rc-field-form/es/useForm.js";import FieldContext,{HOOK_MARK}from"/node_modules/rc-field-form/es/FieldContext.js";import FormContext from"/node_modules/rc-field-form/es/FormContext.js";import{isSimilar}from"/node_modules/rc-field-form/es/utils/valueUtil.js";var Form=function Form(_ref,ref){var name=_ref.name,initialValues=_ref.initialValues,fields=_ref.fields,form=_ref.form,preserve=_ref.preserve,children=_ref.children,_ref$component=_ref.component,Component=void 0===_ref$component?"form":_ref$component,validateMessages=_ref.validateMessages,_ref$validateTrigger=_ref.validateTrigger,validateTrigger=void 0===_ref$validateTrigger?"onChange":_ref$validateTrigger,onValuesChange=_ref.onValuesChange,_onFieldsChange=_ref.onFieldsChange,_onFinish=_ref.onFinish,onFinishFailed=_ref.onFinishFailed,restProps=_objectWithoutProperties(_ref,["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed"]),formContext=React.useContext(FormContext),_useForm=useForm(form),_useForm2=_slicedToArray(_useForm,1),formInstance=_useForm2[0],_formInstance$getInte=formInstance.getInternalHooks(HOOK_MARK),useSubscribe=_formInstance$getInte.useSubscribe,setInitialValues=_formInstance$getInte.setInitialValues,setCallbacks=_formInstance$getInte.setCallbacks,setValidateMessages=_formInstance$getInte.setValidateMessages,setPreserve=_formInstance$getInte.setPreserve;React.useImperativeHandle(ref,function(){return formInstance}),React.useEffect(function(){return formContext.registerForm(name,formInstance),function(){formContext.unregisterForm(name)}},[formContext,formInstance,name]),setValidateMessages(_objectSpread(_objectSpread({},formContext.validateMessages),validateMessages)),setCallbacks({onValuesChange:onValuesChange,onFieldsChange:function onFieldsChange(changedFields){if(formContext.triggerFormChange(name,changedFields),_onFieldsChange){for(var _len=arguments.length,rest=Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)rest[_key-1]=arguments[_key];_onFieldsChange.apply(void 0,[changedFields].concat(rest))}},onFinish:function onFinish(values){formContext.triggerFormFinish(name,values),_onFinish&&_onFinish(values)},onFinishFailed:onFinishFailed}),setPreserve(preserve);var mountRef=React.useRef(null);setInitialValues(initialValues,!mountRef.current),mountRef.current||(mountRef.current=!0);var childrenNode=children,childrenRenderProps="function"==typeof children;if(childrenRenderProps){var values=formInstance.getFieldsValue(!0);childrenNode=children(values,formInstance)}useSubscribe(!childrenRenderProps);var prevFieldsRef=React.useRef();React.useEffect(function(){isSimilar(prevFieldsRef.current||[],fields||[])||formInstance.setFields(fields||[]),prevFieldsRef.current=fields},[fields,formInstance]);var formContextValue=React.useMemo(function(){return _objectSpread(_objectSpread({},formInstance),{},{validateTrigger:validateTrigger})},[formInstance,validateTrigger]),wrapperNode=React.createElement(FieldContext.Provider,{value:formContextValue},childrenNode);return!1===Component?wrapperNode:React.createElement(Component,_extends({},restProps,{onSubmit:function onSubmit(event){event.preventDefault(),event.stopPropagation(),formInstance.submit()}}),wrapperNode)};export default Form;