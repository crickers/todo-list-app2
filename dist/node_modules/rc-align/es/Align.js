import _slicedToArray from"/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _typeof from"/node_modules/@babel/runtime/helpers/esm/typeof.js";import React from"c:\\node_modules\\react\\index.js";import{composeRef}from"/node_modules/rc-util/es/ref.js";import isVisible from"/node_modules/rc-util/es/Dom/isVisible.js";import{alignElement,alignPoint}from"/node_modules/dom-align.js";import addEventListener from"/node_modules/rc-util/es/Dom/addEventListener.js";import{isSamePoint,restoreFocus,monitorResize}from"/node_modules/rc-align/es/util.js";import useBuffer from"/node_modules/rc-align/es/hooks/useBuffer.js";function getElement(func){return"function"==typeof func?func():null}function getPoint(point){return"object"===_typeof(point)&&point?point:null}var Align=function Align(_ref,ref){var children=_ref.children,disabled=_ref.disabled,target=_ref.target,align=_ref.align,onAlign=_ref.onAlign,monitorWindowResize=_ref.monitorWindowResize,_ref$monitorBufferTim=_ref.monitorBufferTime,monitorBufferTime=void 0===_ref$monitorBufferTim?0:_ref$monitorBufferTim,cacheRef=React.useRef({}),nodeRef=React.useRef(),childNode=React.Children.only(children),forceAlignPropsRef=React.useRef({});forceAlignPropsRef.current.disabled=disabled,forceAlignPropsRef.current.target=target,forceAlignPropsRef.current.onAlign=onAlign;var _useBuffer=useBuffer(function(){var _forceAlignPropsRef$c=forceAlignPropsRef.current,latestDisabled=_forceAlignPropsRef$c.disabled,latestTarget=_forceAlignPropsRef$c.target,latestOnAlign=_forceAlignPropsRef$c.onAlign;if(!latestDisabled&&latestTarget){var result,source=nodeRef.current,element=getElement(latestTarget),point=getPoint(latestTarget);cacheRef.current.element=element,cacheRef.current.point=point;var _document=document,activeElement=_document.activeElement;return element&&isVisible(element)?result=alignElement(source,element,align):point&&(result=alignPoint(source,point,align)),restoreFocus(activeElement,source),latestOnAlign&&result&&latestOnAlign(source,result),!0}return!1},monitorBufferTime),_useBuffer2=_slicedToArray(_useBuffer,2),_forceAlign=_useBuffer2[0],cancelForceAlign=_useBuffer2[1],resizeMonitor=React.useRef({cancel:function cancel(){}}),sourceResizeMonitor=React.useRef({cancel:function cancel(){}});React.useEffect(function(){var element=getElement(target),point=getPoint(target);nodeRef.current!==sourceResizeMonitor.current.element&&(sourceResizeMonitor.current.cancel(),sourceResizeMonitor.current.element=nodeRef.current,sourceResizeMonitor.current.cancel=monitorResize(nodeRef.current,_forceAlign)),cacheRef.current.element===element&&isSamePoint(cacheRef.current.point,point)||(_forceAlign(),resizeMonitor.current.element!==element&&(resizeMonitor.current.cancel(),resizeMonitor.current.element=element,resizeMonitor.current.cancel=monitorResize(element,_forceAlign)))}),React.useEffect(function(){disabled?cancelForceAlign():_forceAlign()},[disabled]);var winResizeRef=React.useRef(null);return React.useEffect(function(){monitorWindowResize?!winResizeRef.current&&(winResizeRef.current=addEventListener(window,"resize",_forceAlign)):winResizeRef.current&&(winResizeRef.current.remove(),winResizeRef.current=null)},[monitorWindowResize]),React.useEffect(function(){return function(){resizeMonitor.current.cancel(),sourceResizeMonitor.current.cancel(),winResizeRef.current&&winResizeRef.current.remove(),cancelForceAlign()}},[]),React.useImperativeHandle(ref,function(){return{forceAlign:function forceAlign(){return _forceAlign(!0)}}}),React.isValidElement(childNode)&&(childNode=React.cloneElement(childNode,{ref:composeRef(childNode.ref,nodeRef)})),childNode},RefAlign=React.forwardRef(Align);RefAlign.displayName="Align";export default RefAlign;