import"/node_modules/core-js/modules/es.array.slice.js";import"/node_modules/core-js/modules/es.regexp.to-string.js";import"/node_modules/core-js/modules/es.string.match.js";import"/node_modules/core-js/modules/es.string.replace.js";import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _objectWithoutProperties from"/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js";import _classCallCheck from"/node_modules/@babel/runtime/helpers/esm/classCallCheck.js";import _createClass from"/node_modules/@babel/runtime/helpers/esm/createClass.js";import _assertThisInitialized from"/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js";import _inherits from"/node_modules/@babel/runtime/helpers/esm/inherits.js";import _createSuper from"/node_modules/@babel/runtime/helpers/esm/createSuper.js";import React from"c:\\node_modules\\react\\index.js";import classnames from"/node_modules/classnames.js";import getScrollBarSize from"/node_modules/rc-util/es/getScrollBarSize.js";import KeyCode from"/node_modules/rc-util/es/KeyCode.js";import omit from"/node_modules/rc-util/es/omit.js";import{addEventListener,dataToArray,getTouchParentScroll,isNumeric,removeEventListener,transformArguments,transitionEnd,transitionStr,windowIsUndefined}from"/node_modules/rc-drawer/es/utils.js";var currentDrawer={},DrawerChild=function(_React$Component){function DrawerChild(props){var _this;return _classCallCheck(this,DrawerChild),_this=_super.call(this,props),_this.domFocus=function(){_this.dom&&_this.dom.focus()},_this.removeStartHandler=function(e){1<e.touches.length||(_this.startPos={x:e.touches[0].clientX,y:e.touches[0].clientY})},_this.removeMoveHandler=function(e){if(!(1<e.changedTouches.length)){var currentTarget=e.currentTarget,differX=e.changedTouches[0].clientX-_this.startPos.x,differY=e.changedTouches[0].clientY-_this.startPos.y;(currentTarget===_this.maskDom||currentTarget===_this.handlerDom||currentTarget===_this.contentDom&&getTouchParentScroll(currentTarget,e.target,differX,differY))&&e.cancelable&&e.preventDefault()}},_this.transitionEnd=function(e){var dom=e.target;removeEventListener(dom,transitionEnd,_this.transitionEnd),dom.style.transition=""},_this.onKeyDown=function(e){if(e.keyCode===KeyCode.ESC){var onClose=_this.props.onClose;e.stopPropagation(),onClose&&onClose(e)}},_this.onWrapperTransitionEnd=function(e){var _this$props=_this.props,open=_this$props.open,afterVisibleChange=_this$props.afterVisibleChange;e.target===_this.contentWrapper&&e.propertyName.match(/transform$/)&&(_this.dom.style.transition="",!open&&_this.getCurrentDrawerSome()&&(document.body.style.overflowX="",_this.maskDom&&(_this.maskDom.style.left="",_this.maskDom.style.width="")),afterVisibleChange&&afterVisibleChange(!!open))},_this.openLevelTransition=function(){var _this$props2=_this.props,open=_this$props2.open,width=_this$props2.width,height=_this$props2.height,_this$getHorizontalBo=_this.getHorizontalBoolAndPlacementName(),isHorizontal=_this$getHorizontalBo.isHorizontal,placementName=_this$getHorizontalBo.placementName,contentValue=_this.contentDom?_this.contentDom.getBoundingClientRect()[isHorizontal?"width":"height"]:0,value=(isHorizontal?width:height)||contentValue;_this.setLevelAndScrolling(open,placementName,value)},_this.setLevelTransform=function(open,placementName,value,right){var _this$props3=_this.props,placement=_this$props3.placement,levelMove=_this$props3.levelMove,duration=_this$props3.duration,ease=_this$props3.ease,showMask=_this$props3.showMask;_this.levelDom.forEach(function(dom){dom.style.transition="transform ".concat(duration," ").concat(ease),addEventListener(dom,transitionEnd,_this.transitionEnd);var levelValue=open?value:0;if(levelMove){var $levelMove=transformArguments(levelMove,{target:dom,open:open});levelValue=open?$levelMove[0]:$levelMove[1]||0}var $value="number"==typeof levelValue?"".concat(levelValue,"px"):levelValue,placementPos="left"===placement||"top"===placement?$value:"-".concat($value);placementPos=showMask&&"right"===placement&&right?"calc(".concat(placementPos," + ").concat(right,"px)"):placementPos,dom.style.transform=levelValue?"".concat(placementName,"(").concat(placementPos,")"):""})},_this.setLevelAndScrolling=function(open,placementName,value){var onChange=_this.props.onChange;if(!windowIsUndefined){var right=document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth?getScrollBarSize(!0):0;_this.setLevelTransform(open,placementName,value,right),_this.toggleScrollingToDrawerAndBody(right)}onChange&&onChange(open)},_this.toggleScrollingToDrawerAndBody=function(right){var _this$props4=_this.props,getContainer=_this$props4.getContainer,showMask=_this$props4.showMask,open=_this$props4.open,container=getContainer&&getContainer();if(container&&container.parentNode===document.body&&showMask){var eventArray=["touchstart"],domArray=[document.body,_this.maskDom,_this.handlerDom,_this.contentDom];open&&"hidden"!==document.body.style.overflow?(right&&_this.addScrollingEffect(right),document.body.style.touchAction="none",domArray.forEach(function(item,i){item&&addEventListener(item,eventArray[i]||"touchmove",i?_this.removeMoveHandler:_this.removeStartHandler,_this.passive)})):_this.getCurrentDrawerSome()&&(document.body.style.touchAction="",right&&_this.remScrollingEffect(right),domArray.forEach(function(item,i){item&&removeEventListener(item,eventArray[i]||"touchmove",i?_this.removeMoveHandler:_this.removeStartHandler,_this.passive)}))}},_this.addScrollingEffect=function(right){var _this$props5=_this.props,placement=_this$props5.placement,duration=_this$props5.duration,ease=_this$props5.ease,widthTransition="width ".concat(duration," ").concat(ease),transformTransition="transform ".concat(duration," ").concat(ease);switch(_this.dom.style.transition="none",placement){case"right":_this.dom.style.transform="translateX(-".concat(right,"px)");break;case"top":case"bottom":_this.dom.style.width="calc(100% - ".concat(right,"px)"),_this.dom.style.transform="translateZ(0)";break;default:}clearTimeout(_this.timeout),_this.timeout=setTimeout(function(){_this.dom&&(_this.dom.style.transition="".concat(transformTransition,",").concat(widthTransition),_this.dom.style.width="",_this.dom.style.transform="")})},_this.remScrollingEffect=function(right){var _this$props6=_this.props,placement=_this$props6.placement,duration=_this$props6.duration,ease=_this$props6.ease;transitionStr&&(document.body.style.overflowX="hidden"),_this.dom.style.transition="none";var heightTransition,widthTransition="width ".concat(duration," ").concat(ease),transformTransition="transform ".concat(duration," ").concat(ease);switch(placement){case"left":{_this.dom.style.width="100%",widthTransition="width 0s ".concat(ease," ").concat(duration);break}case"right":{_this.dom.style.transform="translateX(".concat(right,"px)"),_this.dom.style.width="100%",widthTransition="width 0s ".concat(ease," ").concat(duration),_this.maskDom&&(_this.maskDom.style.left="-".concat(right,"px"),_this.maskDom.style.width="calc(100% + ".concat(right,"px)"));break}case"top":case"bottom":{_this.dom.style.width="calc(100% + ".concat(right,"px)"),_this.dom.style.height="100%",_this.dom.style.transform="translateZ(0)",heightTransition="height 0s ".concat(ease," ").concat(duration);break}default:}clearTimeout(_this.timeout),_this.timeout=setTimeout(function(){_this.dom&&(_this.dom.style.transition="".concat(transformTransition,",").concat(heightTransition?"".concat(heightTransition,","):"").concat(widthTransition),_this.dom.style.transform="",_this.dom.style.width="",_this.dom.style.height="")})},_this.getCurrentDrawerSome=function(){return!Object.keys(currentDrawer).some(function(key){return currentDrawer[key]})},_this.getLevelDom=function(_ref){var level=_ref.level,getContainer=_ref.getContainer;if(!windowIsUndefined){var container=getContainer&&getContainer(),parent=container?container.parentNode:null;if(_this.levelDom=[],"all"===level){var children=parent?Array.prototype.slice.call(parent.children):[];children.forEach(function(child){"SCRIPT"!==child.nodeName&&"STYLE"!==child.nodeName&&"LINK"!==child.nodeName&&child!==container&&_this.levelDom.push(child)})}else level&&dataToArray(level).forEach(function(key){document.querySelectorAll(key).forEach(function(item){_this.levelDom.push(item)})})}},_this.getHorizontalBoolAndPlacementName=function(){var placement=_this.props.placement,isHorizontal="left"===placement||"right"===placement,placementName="translate".concat(isHorizontal?"X":"Y");return{isHorizontal:isHorizontal,placementName:placementName}},_this.state={_self:_assertThisInitialized(_this)},_this}_inherits(DrawerChild,_React$Component);var _super=_createSuper(DrawerChild);return _createClass(DrawerChild,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;if(!windowIsUndefined){var passiveSupported=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function get(){return passiveSupported=!0,null}}))}catch(err){}this.passive=!!passiveSupported&&{passive:!1}}var _this$props7=this.props,open=_this$props7.open,getContainer=_this$props7.getContainer,container=getContainer&&getContainer();if(this.drawerId="drawer_id_".concat((+(Date.now()+Math.random()).toString().replace(".",Math.round(9*Math.random()).toString())).toString(16)),this.getLevelDom(this.props),open){var _this$props$scrollLoc;container&&container.parentNode===document.body&&(currentDrawer[this.drawerId]=open),this.openLevelTransition(),this.forceUpdate(function(){_this2.domFocus()}),null===(_this$props$scrollLoc=this.props.scrollLocker)||void 0===_this$props$scrollLoc?void 0:_this$props$scrollLoc.lock()}}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var _this$props8=this.props,open=_this$props8.open,getContainer=_this$props8.getContainer,scrollLocker=_this$props8.scrollLocker,container=getContainer&&getContainer();open!==prevProps.open&&(container&&container.parentNode===document.body&&(currentDrawer[this.drawerId]=!!open),this.openLevelTransition(),open?(this.domFocus(),null===scrollLocker||void 0===scrollLocker?void 0:scrollLocker.lock()):null===scrollLocker||void 0===scrollLocker?void 0:scrollLocker.unLock())}},{key:"componentWillUnmount",value:function componentWillUnmount(){var _this$props9=this.props,open=_this$props9.open,scrollLocker=_this$props9.scrollLocker;delete currentDrawer[this.drawerId],open&&(this.setLevelTransform(!1),document.body.style.touchAction=""),null===scrollLocker||void 0===scrollLocker?void 0:scrollLocker.unLock()}},{key:"render",value:function render(){var _classnames,_this3=this,_this$props10=this.props,className=_this$props10.className,children=_this$props10.children,style=_this$props10.style,width=_this$props10.width,height=_this$props10.height,defaultOpen=_this$props10.defaultOpen,$open=_this$props10.open,prefixCls=_this$props10.prefixCls,placement=_this$props10.placement,level=_this$props10.level,levelMove=_this$props10.levelMove,ease=_this$props10.ease,duration=_this$props10.duration,getContainer=_this$props10.getContainer,handler=_this$props10.handler,onChange=_this$props10.onChange,afterVisibleChange=_this$props10.afterVisibleChange,showMask=_this$props10.showMask,maskClosable=_this$props10.maskClosable,maskStyle=_this$props10.maskStyle,onClose=_this$props10.onClose,onHandleClick=_this$props10.onHandleClick,keyboard=_this$props10.keyboard,getOpenCount=_this$props10.getOpenCount,scrollLocker=_this$props10.scrollLocker,props=_objectWithoutProperties(_this$props10,["className","children","style","width","height","defaultOpen","open","prefixCls","placement","level","levelMove","ease","duration","getContainer","handler","onChange","afterVisibleChange","showMask","maskClosable","maskStyle","onClose","onHandleClick","keyboard","getOpenCount","scrollLocker"]),open=!!this.dom&&$open,wrapperClassName=classnames(prefixCls,(_classnames={},_defineProperty(_classnames,"".concat(prefixCls,"-").concat(placement),!0),_defineProperty(_classnames,"".concat(prefixCls,"-open"),open),_defineProperty(_classnames,className||"",!!className),_defineProperty(_classnames,"no-mask",!showMask),_classnames)),_this$getHorizontalBo2=this.getHorizontalBoolAndPlacementName(),placementName=_this$getHorizontalBo2.placementName,placementPos="left"===placement||"top"===placement?"-100%":"100%",transform=open?"":"".concat(placementName,"(").concat(placementPos,")"),handlerChildren=handler&&React.cloneElement(handler,{onClick:function onClick(e){handler.props.onClick&&handler.props.onClick(),onHandleClick&&onHandleClick(e)},ref:function ref(c){_this3.handlerDom=c}});return React.createElement("div",_extends({},omit(props,["switchScrollingEffect"]),{tabIndex:-1,className:wrapperClassName,style:style,ref:function ref(c){_this3.dom=c},onKeyDown:open&&keyboard?this.onKeyDown:void 0,onTransitionEnd:this.onWrapperTransitionEnd}),showMask&&React.createElement("div",{className:"".concat(prefixCls,"-mask"),onClick:maskClosable?onClose:void 0,style:maskStyle,ref:function ref(c){_this3.maskDom=c}}),React.createElement("div",{className:"".concat(prefixCls,"-content-wrapper"),style:{transform:transform,msTransform:transform,width:isNumeric(width)?"".concat(width,"px"):width,height:isNumeric(height)?"".concat(height,"px"):height},ref:function ref(c){_this3.contentWrapper=c}},React.createElement("div",{className:"".concat(prefixCls,"-content"),ref:function ref(c){_this3.contentDom=c},onTouchStart:open&&showMask?this.removeStartHandler:void 0,onTouchMove:open&&showMask?this.removeMoveHandler:void 0},children),handlerChildren))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,_ref2){var prevProps=_ref2.prevProps,_self=_ref2._self;if(void 0!==prevProps){var placement=props.placement,level=props.level;placement!==prevProps.placement&&(_self.contentDom=null),level!==prevProps.level&&_self.getLevelDom(props)}return{prevProps:props}}}]),DrawerChild}(React.Component);export default DrawerChild;