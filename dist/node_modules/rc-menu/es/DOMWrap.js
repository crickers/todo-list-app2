import"/node_modules/core-js/modules/es.array.index-of.js";import"/node_modules/core-js/modules/es.array.reduce.js";import"/node_modules/core-js/modules/es.array.slice.js";import"/node_modules/core-js/modules/es.object.assign.js";import"/node_modules/core-js/modules/es.string.split.js";import _toConsumableArray from"/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import _objectSpread from"/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import _objectWithoutProperties from"/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js";import _classCallCheck from"/node_modules/@babel/runtime/helpers/esm/classCallCheck.js";import _createClass from"/node_modules/@babel/runtime/helpers/esm/createClass.js";import _inherits from"/node_modules/@babel/runtime/helpers/esm/inherits.js";import _createSuper from"/node_modules/@babel/runtime/helpers/esm/createSuper.js";import React from"c:\\node_modules\\react\\index.js";import ResizeObserver from"/node_modules/resize-observer-polyfill.js";import SubMenu from"/node_modules/rc-menu/es/SubMenu.js";import{getWidth,setStyle,menuAllProps}from"/node_modules/rc-menu/es/util.js";var MENUITEM_OVERFLOWED_CLASSNAME="menuitem-overflowed",FLOAT_PRECISION_ADJUST=.5,DOMWrap=function(_React$Component){function DOMWrap(){var _this;return _classCallCheck(this,DOMWrap),_this=_super.apply(this,arguments),_this.resizeObserver=null,_this.mutationObserver=null,_this.originalTotalWidth=0,_this.overflowedItems=[],_this.menuItemSizes=[],_this.cancelFrameId=null,_this.state={lastVisibleIndex:void 0},_this.childRef=React.createRef(),_this.getMenuItemNodes=function(){var prefixCls=_this.props.prefixCls,ul=_this.childRef.current;return ul?[].slice.call(ul.children).filter(function(node){return 0>node.className.split(" ").indexOf("".concat(prefixCls,"-overflowed-submenu"))}):[]},_this.getOverflowedSubMenuItem=function(keyPrefix,overflowedItems,renderPlaceholder){var _this$props=_this.props,overflowedIndicator=_this$props.overflowedIndicator,level=_this$props.level,mode=_this$props.mode,prefixCls=_this$props.prefixCls,theme=_this$props.theme;if(1!==level||"horizontal"!==mode)return null;var copy=_this.props.children[0],_copy$props=copy.props,throwAway=_copy$props.children,title=_copy$props.title,propStyle=_copy$props.style,rest=_objectWithoutProperties(_copy$props,["children","title","style"]),style=_objectSpread({},propStyle),key="".concat(keyPrefix,"-overflowed-indicator"),eventKey="".concat(keyPrefix,"-overflowed-indicator");0===overflowedItems.length&&!0!==renderPlaceholder?style=_objectSpread(_objectSpread({},style),{},{display:"none"}):renderPlaceholder&&(style=_objectSpread(_objectSpread({},style),{},{visibility:"hidden",position:"absolute"}),key="".concat(key,"-placeholder"),eventKey="".concat(eventKey,"-placeholder"));var popupClassName=theme?"".concat(prefixCls,"-").concat(theme):"",props={};return menuAllProps.forEach(function(k){void 0!==rest[k]&&(props[k]=rest[k])}),React.createElement(SubMenu,Object.assign({title:overflowedIndicator,className:"".concat(prefixCls,"-overflowed-submenu"),popupClassName:popupClassName},props,{key:key,eventKey:eventKey,disabled:!1,style:style}),overflowedItems)},_this.setChildrenWidthAndResize=function(){if("horizontal"===_this.props.mode){var ul=_this.childRef.current;if(ul){var ulChildrenNodes=ul.children;if(ulChildrenNodes&&0!==ulChildrenNodes.length){var lastOverflowedIndicatorPlaceholder=ul.children[ulChildrenNodes.length-1];setStyle(lastOverflowedIndicatorPlaceholder,"display","inline-block");var menuItemNodes=_this.getMenuItemNodes(),overflowedItems=menuItemNodes.filter(function(c){return 0<=c.className.split(" ").indexOf(MENUITEM_OVERFLOWED_CLASSNAME)});overflowedItems.forEach(function(c){setStyle(c,"display","inline-block")}),_this.menuItemSizes=menuItemNodes.map(function(c){return getWidth(c,!0)}),overflowedItems.forEach(function(c){setStyle(c,"display","none")}),_this.overflowedIndicatorWidth=getWidth(ul.children[ul.children.length-1],!0),_this.originalTotalWidth=_this.menuItemSizes.reduce(function(acc,cur){return acc+cur},0),_this.handleResize(),setStyle(lastOverflowedIndicatorPlaceholder,"display","none")}}}},_this.handleResize=function(){if("horizontal"===_this.props.mode){var ul=_this.childRef.current;if(ul){var width=getWidth(ul);_this.overflowedItems=[];var lastVisibleIndex,currentSumWidth=0;_this.originalTotalWidth>width+FLOAT_PRECISION_ADJUST&&(lastVisibleIndex=-1,_this.menuItemSizes.forEach(function(liWidth){currentSumWidth+=liWidth,currentSumWidth+_this.overflowedIndicatorWidth<=width&&(lastVisibleIndex+=1)})),_this.setState({lastVisibleIndex:lastVisibleIndex})}}},_this}_inherits(DOMWrap,_React$Component);var _super=_createSuper(DOMWrap);return _createClass(DOMWrap,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;if(this.setChildrenWidthAndResize(),1===this.props.level&&"horizontal"===this.props.mode){var menuUl=this.childRef.current;if(!menuUl)return;this.resizeObserver=new ResizeObserver(function(entries){entries.forEach(function(){var cancelFrameId=_this2.cancelFrameId;cancelAnimationFrame(cancelFrameId),_this2.cancelFrameId=requestAnimationFrame(_this2.setChildrenWidthAndResize)})}),[].slice.call(menuUl.children).concat(menuUl).forEach(function(el){_this2.resizeObserver.observe(el)}),"undefined"!=typeof MutationObserver&&(this.mutationObserver=new MutationObserver(function(){_this2.resizeObserver.disconnect(),[].slice.call(menuUl.children).concat(menuUl).forEach(function(el){_this2.resizeObserver.observe(el)}),_this2.setChildrenWidthAndResize()}),this.mutationObserver.observe(menuUl,{attributes:!1,childList:!0,subTree:!1}))}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.mutationObserver&&this.mutationObserver.disconnect(),cancelAnimationFrame(this.cancelFrameId)}},{key:"renderChildren",value:function renderChildren(children){var _this3=this,lastVisibleIndex=this.state.lastVisibleIndex;return(children||[]).reduce(function(acc,childNode,index){var item=childNode;if("horizontal"===_this3.props.mode){var overflowed=_this3.getOverflowedSubMenuItem(childNode.props.eventKey,[]);void 0!==lastVisibleIndex&&-1!==_this3.props.className.indexOf("".concat(_this3.props.prefixCls,"-root"))&&(index>lastVisibleIndex&&(item=React.cloneElement(childNode,{style:{display:"none"},eventKey:"".concat(childNode.props.eventKey,"-hidden"),className:"".concat(MENUITEM_OVERFLOWED_CLASSNAME)})),index===lastVisibleIndex+1&&(_this3.overflowedItems=children.slice(lastVisibleIndex+1).map(function(c){return React.cloneElement(c,{key:c.props.eventKey,mode:"vertical-left"})}),overflowed=_this3.getOverflowedSubMenuItem(childNode.props.eventKey,_this3.overflowedItems)));var ret=[].concat(_toConsumableArray(acc),[overflowed,item]);return index===children.length-1&&ret.push(_this3.getOverflowedSubMenuItem(childNode.props.eventKey,[],!0)),ret}return[].concat(_toConsumableArray(acc),[item])},[])}},{key:"render",value:function render(){var _this$props2=this.props,visible=_this$props2.visible,prefixCls=_this$props2.prefixCls,overflowedIndicator=_this$props2.overflowedIndicator,mode=_this$props2.mode,level=_this$props2.level,tag=_this$props2.tag,children=_this$props2.children,theme=_this$props2.theme,rest=_objectWithoutProperties(_this$props2,["visible","prefixCls","overflowedIndicator","mode","level","tag","children","theme"]);return React.createElement(tag,Object.assign({ref:this.childRef},rest),this.renderChildren(children))}}]),DOMWrap}(React.Component);DOMWrap.defaultProps={tag:"div",className:""};export default DOMWrap;