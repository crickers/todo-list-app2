import"/node_modules/core-js/modules/es.array.index-of.js";import"/node_modules/core-js/modules/es.array.reverse.js";import"/node_modules/core-js/modules/es.array.slice.js";import"/node_modules/core-js/modules/es.object.assign.js";import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _classCallCheck from"/node_modules/@babel/runtime/helpers/esm/classCallCheck.js";import _createClass from"/node_modules/@babel/runtime/helpers/esm/createClass.js";import _assertThisInitialized from"/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js";import _inherits from"/node_modules/@babel/runtime/helpers/esm/inherits.js";import _createSuper from"/node_modules/@babel/runtime/helpers/esm/createSuper.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _objectSpread from"/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import React from"c:\\node_modules\\react\\index.js";import{connect}from"/node_modules/mini-store.js";import KeyCode from"/node_modules/rc-util/es/KeyCode.js";import createChainedFunction from"/node_modules/rc-util/es/createChainedFunction.js";import toArray from"/node_modules/rc-util/es/Children/toArray.js";import shallowEqual from"/node_modules/shallowequal.js";import classNames from"/node_modules/classnames.js";import{getKeyFromChildrenIndex,loopMenuItem,noop,menuAllProps,isMobileDevice}from"/node_modules/rc-menu/es/util.js";import DOMWrap from"/node_modules/rc-menu/es/DOMWrap.js";function allDisabled(arr){return!arr.length||arr.every(function(c){return!!c.props.disabled})}function updateActiveKey(store,menuId,activeKey){var state=store.getState();store.setState({activeKey:_objectSpread(_objectSpread({},state.activeKey),{},_defineProperty({},menuId,activeKey))})}function getEventKey(props){return props.eventKey||"0-menu-"}export function getActiveKey(props,originalActiveKey){var activeKey=originalActiveKey,children=props.children,eventKey=props.eventKey;if(activeKey){var found;if(loopMenuItem(children,function(c,i){c&&c.props&&!c.props.disabled&&activeKey===getKeyFromChildrenIndex(c,eventKey,i)&&(found=!0)}),found)return activeKey}return activeKey=null,props.defaultActiveFirst?(loopMenuItem(children,function(c,i){activeKey||!c||c.props.disabled||(activeKey=getKeyFromChildrenIndex(c,eventKey,i))}),activeKey):activeKey}export function saveRef(c){if(c){var index=this.instanceArray.indexOf(c);-1===index?this.instanceArray.push(c):this.instanceArray[index]=c}}export var SubPopupMenu=function(_React$Component){function SubPopupMenu(props){var _this;return _classCallCheck(this,SubPopupMenu),_this=_super.call(this,props),_this.onKeyDown=function(e,callback){var handled,keyCode=e.keyCode;if(_this.getFlatInstanceArray().forEach(function(obj){obj&&obj.props.active&&obj.onKeyDown&&(handled=obj.onKeyDown(e))}),handled)return 1;var activeItem=null;return(keyCode===KeyCode.UP||keyCode===KeyCode.DOWN)&&(activeItem=_this.step(keyCode===KeyCode.UP?-1:1)),activeItem?(e.preventDefault(),updateActiveKey(_this.props.store,getEventKey(_this.props),activeItem.props.eventKey),"function"==typeof callback&&callback(activeItem),1):void 0},_this.onItemHover=function(e){var key=e.key,hover=e.hover;updateActiveKey(_this.props.store,getEventKey(_this.props),hover?key:null)},_this.onDeselect=function(selectInfo){_this.props.onDeselect(selectInfo)},_this.onSelect=function(selectInfo){_this.props.onSelect(selectInfo)},_this.onClick=function(e){_this.props.onClick(e)},_this.onOpenChange=function(e){_this.props.onOpenChange(e)},_this.onDestroy=function(key){_this.props.onDestroy(key)},_this.getFlatInstanceArray=function(){return _this.instanceArray},_this.step=function(direction){var children=_this.getFlatInstanceArray(),activeKey=_this.props.store.getState().activeKey[getEventKey(_this.props)],len=children.length;if(!len)return null;0>direction&&(children=children.concat().reverse());var activeIndex=-1;if(children.every(function(c,ci){return!(c&&c.props.eventKey===activeKey)||(activeIndex=ci,!1)}),_this.props.defaultActiveFirst||-1===activeIndex||!allDisabled(children.slice(activeIndex,len-1))){var start=(activeIndex+1)%len,i=start;do{var child=children[i];if(!child||child.props.disabled)i=(i+1)%len;else return child}while(i!==start);return null}},_this.renderCommonMenuItem=function(child,i,extraProps){var state=_this.props.store.getState(),_assertThisInitialize=_assertThisInitialized(_this),props=_assertThisInitialize.props,key=getKeyFromChildrenIndex(child,props.eventKey,i),childProps=child.props;if(!childProps||"string"==typeof child.type)return child;var isActive=key===state.activeKey,newChildProps=_objectSpread(_objectSpread({mode:childProps.mode||props.mode,level:props.level,inlineIndent:props.inlineIndent,renderMenuItem:_this.renderMenuItem,rootPrefixCls:props.prefixCls,index:i,parentMenu:props.parentMenu,manualRef:childProps.disabled?void 0:createChainedFunction(child.ref,saveRef.bind(_assertThisInitialized(_this))),eventKey:key,active:!childProps.disabled&&isActive,multiple:props.multiple,onClick:function onClick(e){(childProps.onClick||noop)(e),_this.onClick(e)},onItemHover:_this.onItemHover,motion:props.motion,subMenuOpenDelay:props.subMenuOpenDelay,subMenuCloseDelay:props.subMenuCloseDelay,forceSubMenuRender:props.forceSubMenuRender,onOpenChange:_this.onOpenChange,onDeselect:_this.onDeselect,onSelect:_this.onSelect,builtinPlacements:props.builtinPlacements,itemIcon:childProps.itemIcon||_this.props.itemIcon,expandIcon:childProps.expandIcon||_this.props.expandIcon},extraProps),{},{direction:props.direction});return("inline"===props.mode||isMobileDevice())&&(newChildProps.triggerSubMenuAction="click"),React.cloneElement(child,_objectSpread(_objectSpread({},newChildProps),{},{key:key||i}))},_this.renderMenuItem=function(c,i,subMenuKey){if(!c)return null;var state=_this.props.store.getState(),extraProps={openKeys:state.openKeys,selectedKeys:state.selectedKeys,triggerSubMenuAction:_this.props.triggerSubMenuAction,subMenuKey:subMenuKey};return _this.renderCommonMenuItem(c,i,extraProps)},props.store.setState({activeKey:_objectSpread(_objectSpread({},props.store.getState().activeKey),{},_defineProperty({},props.eventKey,getActiveKey(props,props.activeKey)))}),_this.instanceArray=[],_this}_inherits(SubPopupMenu,_React$Component);var _super=_createSuper(SubPopupMenu);return _createClass(SubPopupMenu,[{key:"componentDidMount",value:function componentDidMount(){this.props.manualRef&&this.props.manualRef(this)}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps){return this.props.visible||nextProps.visible||this.props.className!==nextProps.className||!shallowEqual(this.props.style,nextProps.style)}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var props=this.props,originalActiveKey="activeKey"in props?props.activeKey:props.store.getState().activeKey[getEventKey(props)],activeKey=getActiveKey(props,originalActiveKey);if(activeKey!==originalActiveKey)updateActiveKey(props.store,getEventKey(props),activeKey);else if("activeKey"in prevProps){var prevActiveKey=getActiveKey(prevProps,prevProps.activeKey);activeKey!==prevActiveKey&&updateActiveKey(props.store,getEventKey(props),activeKey)}}},{key:"render",value:function render(){var _this2=this,props=_extends({},this.props);this.instanceArray=[];var className=classNames(props.prefixCls,props.className,"".concat(props.prefixCls,"-").concat(props.mode)),domProps={className:className,role:props.role||"menu"};props.id&&(domProps.id=props.id),props.focusable&&(domProps.tabIndex=0,domProps.onKeyDown=this.onKeyDown);var prefixCls=props.prefixCls,eventKey=props.eventKey,visible=props.visible,level=props.level,mode=props.mode,overflowedIndicator=props.overflowedIndicator,theme=props.theme;return menuAllProps.forEach(function(key){return delete props[key]}),delete props.onClick,React.createElement(DOMWrap,Object.assign({},props,{prefixCls:prefixCls,mode:mode,tag:"ul",level:level,theme:theme,visible:visible,overflowedIndicator:overflowedIndicator},domProps),toArray(props.children).map(function(c,i){return _this2.renderMenuItem(c,i,eventKey||"0-menu-")}))}}]),SubPopupMenu}(React.Component);SubPopupMenu.defaultProps={prefixCls:"rc-menu",className:"",mode:"vertical",level:1,inlineIndent:24,visible:!0,focusable:!0,style:{},manualRef:noop};var connected=connect()(SubPopupMenu);export default connected;