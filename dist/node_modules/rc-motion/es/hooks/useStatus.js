import _objectSpread from"/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _slicedToArray from"/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import React from"c:\\node_modules\\react\\index.js";import{useRef,useEffect}from"c:\\node_modules\\react\\index.js";import{STATUS_APPEAR,STATUS_NONE,STATUS_LEAVE,STATUS_ENTER,STEP_PREPARE,STEP_START,STEP_ACTIVE}from"/node_modules/rc-motion/es/interface.js";import useState from"/node_modules/rc-motion/es/hooks/useState.js";import useIsomorphicLayoutEffect from"/node_modules/rc-motion/es/hooks/useIsomorphicLayoutEffect.js";import useStepQueue,{DoStep,SkipStep,isActive}from"/node_modules/rc-motion/es/hooks/useStepQueue.js";import useDomMotionEvents from"/node_modules/rc-motion/es/hooks/useDomMotionEvents.js";export default function useStatus(supportMotion,visible,getElement,_ref){function getDomElement(){var element=getElement();return element||cacheElementRef.current}function onInternalMotionEnd(event){var element=getDomElement();if(!event||event.deadline||event.target===element){var canEnd;status===STATUS_APPEAR&&activeRef.current?canEnd=null===onAppearEnd||void 0===onAppearEnd?void 0:onAppearEnd(element,event):status===STATUS_ENTER&&activeRef.current?canEnd=null===onEnterEnd||void 0===onEnterEnd?void 0:onEnterEnd(element,event):status===STATUS_LEAVE&&activeRef.current&&(canEnd=null===onLeaveEnd||void 0===onLeaveEnd?void 0:onLeaveEnd(element,event)),!1===canEnd||destroyedRef.current||(setStatus(STATUS_NONE),setStyle(null))}}var _ref$motionEnter=_ref.motionEnter,motionEnter=void 0===_ref$motionEnter||_ref$motionEnter,_ref$motionAppear=_ref.motionAppear,motionAppear=void 0===_ref$motionAppear||_ref$motionAppear,_ref$motionLeave=_ref.motionLeave,motionLeave=void 0===_ref$motionLeave||_ref$motionLeave,motionDeadline=_ref.motionDeadline,motionLeaveImmediately=_ref.motionLeaveImmediately,onAppearPrepare=_ref.onAppearPrepare,onEnterPrepare=_ref.onEnterPrepare,onLeavePrepare=_ref.onLeavePrepare,onAppearStart=_ref.onAppearStart,onEnterStart=_ref.onEnterStart,onLeaveStart=_ref.onLeaveStart,onAppearActive=_ref.onAppearActive,onEnterActive=_ref.onEnterActive,onLeaveActive=_ref.onLeaveActive,onAppearEnd=_ref.onAppearEnd,onEnterEnd=_ref.onEnterEnd,onLeaveEnd=_ref.onLeaveEnd,onVisibleChanged=_ref.onVisibleChanged,_useState=useState(),_useState2=_slicedToArray(_useState,2),asyncVisible=_useState2[0],setAsyncVisible=_useState2[1],_useState3=useState(STATUS_NONE),_useState4=_slicedToArray(_useState3,2),status=_useState4[0],setStatus=_useState4[1],_useState5=useState(null),_useState6=_slicedToArray(_useState5,2),style=_useState6[0],setStyle=_useState6[1],mountedRef=useRef(!1),deadlineRef=useRef(null),destroyedRef=useRef(!1),cacheElementRef=useRef(null),activeRef=useRef(!1),_useDomMotionEvents=useDomMotionEvents(onInternalMotionEnd),_useDomMotionEvents2=_slicedToArray(_useDomMotionEvents,1),patchMotionEvents=_useDomMotionEvents2[0],eventHandlers=React.useMemo(function(){var _ref2,_ref3,_ref4;return"appear"===status?(_ref2={},_defineProperty(_ref2,STEP_PREPARE,onAppearPrepare),_defineProperty(_ref2,STEP_START,onAppearStart),_defineProperty(_ref2,STEP_ACTIVE,onAppearActive),_ref2):"enter"===status?(_ref3={},_defineProperty(_ref3,STEP_PREPARE,onEnterPrepare),_defineProperty(_ref3,STEP_START,onEnterStart),_defineProperty(_ref3,STEP_ACTIVE,onEnterActive),_ref3):"leave"===status?(_ref4={},_defineProperty(_ref4,STEP_PREPARE,onLeavePrepare),_defineProperty(_ref4,STEP_START,onLeaveStart),_defineProperty(_ref4,STEP_ACTIVE,onLeaveActive),_ref4):{}},[status]),_useStepQueue=useStepQueue(status,function(newStep){if(newStep===STEP_PREPARE){var onPrepare=eventHandlers[STEP_PREPARE];return onPrepare?onPrepare(getDomElement()):SkipStep}if(step in eventHandlers){var _eventHandlers$step;setStyle((null===(_eventHandlers$step=eventHandlers[step])||void 0===_eventHandlers$step?void 0:_eventHandlers$step.call(eventHandlers,getDomElement(),null))||null)}return step===STEP_ACTIVE&&(patchMotionEvents(getDomElement()),0<motionDeadline&&(clearTimeout(deadlineRef.current),deadlineRef.current=setTimeout(function(){onInternalMotionEnd({deadline:!0})},motionDeadline))),DoStep}),_useStepQueue2=_slicedToArray(_useStepQueue,2),startStep=_useStepQueue2[0],step=_useStepQueue2[1],active=isActive(step);activeRef.current=active,useIsomorphicLayoutEffect(function(){if(setAsyncVisible(visible),!!supportMotion){var isMounted=mountedRef.current;mountedRef.current=!0;var nextStatus;!isMounted&&visible&&motionAppear&&(nextStatus=STATUS_APPEAR),isMounted&&visible&&motionEnter&&(nextStatus=STATUS_ENTER),(isMounted&&!visible&&motionLeave||!isMounted&&motionLeaveImmediately&&!visible&&motionLeave)&&(nextStatus=STATUS_LEAVE),nextStatus&&(setStatus(nextStatus),startStep())}},[visible]),useEffect(function(){(status!==STATUS_APPEAR||motionAppear)&&(status!==STATUS_ENTER||motionEnter)&&(status!==STATUS_LEAVE||motionLeave)||setStatus(STATUS_NONE)},[motionAppear,motionEnter,motionLeave]),useEffect(function(){return function(){clearTimeout(deadlineRef.current),destroyedRef.current=!0}},[]),useEffect(function(){void 0!==asyncVisible&&status===STATUS_NONE&&(null===onVisibleChanged||void 0===onVisibleChanged?void 0:onVisibleChanged(asyncVisible))},[asyncVisible,status]);var mergedStyle=style;return eventHandlers[STEP_PREPARE]&&step===STEP_START&&(mergedStyle=_objectSpread({transition:"none"},mergedStyle)),[status,step,mergedStyle,null!==asyncVisible&&void 0!==asyncVisible?asyncVisible:visible]}