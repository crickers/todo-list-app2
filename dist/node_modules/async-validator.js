import"/node_modules/core-js/modules/es.array.index-of.js";import"/node_modules/core-js/modules/es.array.iterator.js";import"/node_modules/core-js/modules/es.array.slice.js";import"/node_modules/core-js/modules/es.array.splice.js";import"/node_modules/core-js/modules/es.object.assign.js";import"/node_modules/core-js/modules/es.promise.js";import"/node_modules/core-js/modules/es.regexp.constructor.js";import"/node_modules/core-js/modules/es.regexp.to-string.js";import"/node_modules/core-js/modules/es.string.match.js";import"/node_modules/core-js/modules/es.string.replace.js";import"/node_modules/core-js/modules/esnext.array.last-index.js";import"/node_modules/core-js/modules/esnext.map.delete-all.js";import"/node_modules/core-js/modules/esnext.map.every.js";import"/node_modules/core-js/modules/esnext.map.filter.js";import"/node_modules/core-js/modules/esnext.map.find.js";import"/node_modules/core-js/modules/esnext.map.find-key.js";import"/node_modules/core-js/modules/esnext.map.includes.js";import"/node_modules/core-js/modules/esnext.map.key-of.js";import"/node_modules/core-js/modules/esnext.map.map-keys.js";import"/node_modules/core-js/modules/esnext.map.map-values.js";import"/node_modules/core-js/modules/esnext.map.merge.js";import"/node_modules/core-js/modules/esnext.map.reduce.js";import"/node_modules/core-js/modules/esnext.map.some.js";import"/node_modules/core-js/modules/esnext.map.update.js";import"/node_modules/core-js/modules/web.dom-collections.iterator.js";import process from"/node_modules/process/browser.js";function _extends(){return _extends=Object.assign||function(target){for(var source,i=1;i<arguments.length;i++)for(var key in source=arguments[i],source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key]);return target},_extends.apply(this,arguments)}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(Parent,args,Class){return _construct=_isNativeReflectConstruct()?Reflect.construct:function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a),instance=new Constructor;return Class&&_setPrototypeOf(instance,Class.prototype),instance},_construct.apply(null,arguments)}function _isNativeFunction(fn){return-1!==Function.toString.call(fn).indexOf("[native code]")}function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function _wrapNativeSuper(Class){function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}if(null===Class||!_isNativeFunction(Class))return Class;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof _cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class)},_wrapNativeSuper(Class)}var formatRegExp=/%[sdj%]/g,warning=function warning(){};"undefined"!=typeof process&&process.env&&!1&&!0&&"undefined"!=typeof document&&(warning=function warning(type,errors){"undefined"!=typeof console&&console.warn&&errors.every(function(e){return"string"==typeof e})&&console.warn(type,errors)});function convertFieldsError(errors){if(!errors||!errors.length)return null;var fields={};return errors.forEach(function(error){var field=error.field;fields[field]=fields[field]||[],fields[field].push(error)}),fields}function format(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var i=1,f=args[0],len=args.length;if("function"==typeof f)return f.apply(null,args.slice(1));if("string"==typeof f){var str=(f+"").replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return args[i++]+"";case"%d":return+args[i++];case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}break;default:return x;}});return str}return f}function isNativeStringType(type){return"string"===type||"url"===type||"hex"===type||"email"===type||"date"===type||"pattern"===type}function isEmptyValue(value,type){return!(void 0!==value&&null!==value)||!("array"!==type||!Array.isArray(value)||value.length)||!(!isNativeStringType(type)||"string"!=typeof value||value)}function asyncParallelArray(arr,func,callback){function count(errors){results.push.apply(results,errors),total++,total===arrLength&&callback(results)}var results=[],total=0,arrLength=arr.length;arr.forEach(function(a){func(a,count)})}function asyncSerialArray(arr,func,callback){function next(errors){if(errors&&errors.length)return void callback(errors);var original=index;++index,original<arrLength?func(arr[original],next):callback([])}var index=0,arrLength=arr.length;next([])}function flattenObjArr(objArr){var ret=[];return Object.keys(objArr).forEach(function(k){ret.push.apply(ret,objArr[k])}),ret}var AsyncValidationError=function(_Error){function AsyncValidationError(errors,fields){var _this=_Error.call(this,"Async Validation Error")||this;return _this.errors=errors,_this.fields=fields,_this}return _inheritsLoose(AsyncValidationError,_Error),AsyncValidationError}(_wrapNativeSuper(Error));function asyncMap(objArr,option,func,callback){if(option.first){var _pending=new Promise(function(resolve,reject){var flattenArr=flattenObjArr(objArr);asyncSerialArray(flattenArr,func,function next(errors){return callback(errors),errors.length?reject(new AsyncValidationError(errors,convertFieldsError(errors))):resolve()})});return _pending["catch"](function(e){return e}),_pending}var firstFields=option.firstFields||[];!0===firstFields&&(firstFields=Object.keys(objArr));var objArrKeys=Object.keys(objArr),objArrLength=objArrKeys.length,total=0,results=[],pending=new Promise(function(resolve,reject){var next=function next(errors){if(results.push.apply(results,errors),total++,total===objArrLength)return callback(results),results.length?reject(new AsyncValidationError(results,convertFieldsError(results))):resolve()};objArrKeys.length||(callback(results),resolve()),objArrKeys.forEach(function(key){var arr=objArr[key];-1===firstFields.indexOf(key)?asyncParallelArray(arr,func,next):asyncSerialArray(arr,func,next)})});return pending["catch"](function(e){return e}),pending}function complementError(rule){return function(oe){return oe&&oe.message?(oe.field=oe.field||rule.fullField,oe):{message:"function"==typeof oe?oe():oe,field:oe.field||rule.fullField}}}function deepMerge(target,source){if(source)for(var s in source)if(source.hasOwnProperty(s)){var value=source[s];target[s]="object"==typeof value&&"object"==typeof target[s]?_extends(_extends({},target[s]),value):value}return target}function required(rule,value,source,errors,options,type){rule.required&&(!source.hasOwnProperty(rule.field)||isEmptyValue(value,type||rule.type))&&errors.push(format(options.messages.required,rule.fullField))}function whitespace(rule,value,source,errors,options){(/^\s+$/.test(value)||""===value)&&errors.push(format(options.messages.whitespace,rule.fullField))}var pattern={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,url:/^(?!mailto:)(?:(?:http|https|ftp):\/\/|\/\/)(?:\S+(?::\S*)?@)?(?:(?:(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[0-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))|localhost)(?::\d{2,5})?(?:(\/|\?|#)[^\s]*)?$/i,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},types={integer:function integer(value){return types.number(value)&&parseInt(value,10)===value},float:function float(value){return types.number(value)&&!types.integer(value)},array:function array(value){return Array.isArray(value)},regexp:function regexp(value){if(value instanceof RegExp)return!0;try{return!!new RegExp(value)}catch(e){return!1}},date:function date(value){return"function"==typeof value.getTime&&"function"==typeof value.getMonth&&"function"==typeof value.getYear&&!isNaN(value.getTime())},number:function number(value){return!isNaN(value)&&"number"==typeof value},object:function object(value){return"object"==typeof value&&!types.array(value)},method:function method(value){return"function"==typeof value},email:function email(value){return"string"==typeof value&&!!value.match(pattern.email)&&255>value.length},url:function url(value){return"string"==typeof value&&!!value.match(pattern.url)},hex:function hex(value){return"string"==typeof value&&!!value.match(pattern.hex)}};function type(rule,value,source,errors,options){if(rule.required&&void 0===value)return void required(rule,value,source,errors,options);var ruleType=rule.type;-1<["integer","float","array","regexp","object","method","email","number","date","url","hex"].indexOf(ruleType)?!types[ruleType](value)&&errors.push(format(options.messages.types[ruleType],rule.fullField,rule.type)):ruleType&&typeof value!==rule.type&&errors.push(format(options.messages.types[ruleType],rule.fullField,rule.type))}function range(rule,value,source,errors,options){var len="number"==typeof rule.len,min="number"==typeof rule.min,max="number"==typeof rule.max,val=value,key=null,str="string"==typeof value,arr=Array.isArray(value);return"number"==typeof value?key="number":str?key="string":arr&&(key="array"),!!key&&void(arr&&(val=value.length),str&&(val=value.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length),len?val!==rule.len&&errors.push(format(options.messages[key].len,rule.fullField,rule.len)):min&&!max&&val<rule.min?errors.push(format(options.messages[key].min,rule.fullField,rule.min)):max&&!min&&val>rule.max?errors.push(format(options.messages[key].max,rule.fullField,rule.max)):min&&max&&(val<rule.min||val>rule.max)&&errors.push(format(options.messages[key].range,rule.fullField,rule.min,rule.max)))}var ENUM="enum";function enumerable(rule,value,source,errors,options){rule[ENUM]=Array.isArray(rule[ENUM])?rule[ENUM]:[],-1===rule[ENUM].indexOf(value)&&errors.push(format(options.messages[ENUM],rule.fullField,rule[ENUM].join(", ")))}function pattern$1(rule,value,source,errors,options){if(rule.pattern)if(rule.pattern instanceof RegExp)rule.pattern.lastIndex=0,rule.pattern.test(value)||errors.push(format(options.messages.pattern.mismatch,rule.fullField,value,rule.pattern));else if("string"==typeof rule.pattern){var _pattern=new RegExp(rule.pattern);_pattern.test(value)||errors.push(format(options.messages.pattern.mismatch,rule.fullField,value,rule.pattern))}}var rules={required:required,whitespace:whitespace,type:type,range:range,enum:enumerable,pattern:pattern$1};function string(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value,"string")&&!rule.required)return callback();rules.required(rule,value,source,errors,options,"string"),isEmptyValue(value,"string")||(rules.type(rule,value,source,errors,options),rules.range(rule,value,source,errors,options),rules.pattern(rule,value,source,errors,options),!0===rule.whitespace&&rules.whitespace(rule,value,source,errors,options))}callback(errors)}function method(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options),value!==void 0&&rules.type(rule,value,source,errors,options)}callback(errors)}function number(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(""===value&&(value=void 0),isEmptyValue(value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options),void 0!==value&&(rules.type(rule,value,source,errors,options),rules.range(rule,value,source,errors,options))}callback(errors)}function _boolean(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options),value!==void 0&&rules.type(rule,value,source,errors,options)}callback(errors)}function regexp(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options),isEmptyValue(value)||rules.type(rule,value,source,errors,options)}callback(errors)}function integer(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options),value!==void 0&&(rules.type(rule,value,source,errors,options),rules.range(rule,value,source,errors,options))}callback(errors)}function floatFn(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options),value!==void 0&&(rules.type(rule,value,source,errors,options),rules.range(rule,value,source,errors,options))}callback(errors)}function array(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if((value===void 0||null===value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options,"array"),value!==void 0&&null!==value&&(rules.type(rule,value,source,errors,options),rules.range(rule,value,source,errors,options))}callback(errors)}function object(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options),value!==void 0&&rules.type(rule,value,source,errors,options)}callback(errors)}var ENUM$1="enum";function enumerable$1(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options),value!==void 0&&rules[ENUM$1](rule,value,source,errors,options)}callback(errors)}function pattern$2(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value,"string")&&!rule.required)return callback();rules.required(rule,value,source,errors,options),isEmptyValue(value,"string")||rules.pattern(rule,value,source,errors,options)}callback(errors)}function date(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value,"date")&&!rule.required)return callback();if(rules.required(rule,value,source,errors,options),!isEmptyValue(value,"date")){var dateObject;dateObject=value instanceof Date?value:new Date(value),rules.type(rule,dateObject,source,errors,options),dateObject&&rules.range(rule,dateObject.getTime(),source,errors,options)}}callback(errors)}function required$1(rule,value,callback,source,options){var errors=[],type=Array.isArray(value)?"array":typeof value;rules.required(rule,value,source,errors,options,type),callback(errors)}function type$1(rule,value,callback,source,options){var ruleType=rule.type,errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value,ruleType)&&!rule.required)return callback();rules.required(rule,value,source,errors,options,ruleType),isEmptyValue(value,ruleType)||rules.type(rule,value,source,errors,options)}callback(errors)}function any(rule,value,callback,source,options){var errors=[],validate=rule.required||!rule.required&&source.hasOwnProperty(rule.field);if(validate){if(isEmptyValue(value)&&!rule.required)return callback();rules.required(rule,value,source,errors,options)}callback(errors)}var validators={string:string,method:method,number:number,boolean:_boolean,regexp:regexp,integer:integer,float:floatFn,array:array,object:object,enum:enumerable$1,pattern:pattern$2,date:date,url:type$1,hex:type$1,email:type$1,required:required$1,any:any};function newMessages(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function clone(){var cloned=JSON.parse(JSON.stringify(this));return cloned.clone=this.clone,cloned}}}var messages=newMessages();function Schema(descriptor){this.rules=null,this._messages=messages,this.define(descriptor)}Schema.prototype={messages:function messages(_messages){return _messages&&(this._messages=deepMerge(newMessages(),_messages)),this._messages},define:function define(rules){if(!rules)throw new Error("Cannot configure a schema with no rules");if("object"!=typeof rules||Array.isArray(rules))throw new Error("Rules must be an object");this.rules={};var item;for(var z in rules)rules.hasOwnProperty(z)&&(item=rules[z],this.rules[z]=Array.isArray(item)?item:[item])},validate:function validate(source_,o,oc){function complete(results){function add(e){if(Array.isArray(e)){var _errors;errors=(_errors=errors).concat.apply(_errors,e)}else errors.push(e)}var i,errors=[],fields={};for(i=0;i<results.length;i++)add(results[i]);errors.length?fields=convertFieldsError(errors):(errors=null,fields=null),callback(errors,fields)}var _this=this;void 0===o&&(o={}),void 0===oc&&(oc=function oc(){});var source=source_,options=o,callback=oc;if("function"==typeof options&&(callback=options,options={}),!this.rules||0===Object.keys(this.rules).length)return callback&&callback(),Promise.resolve();if(options.messages){var messages$1=this.messages();messages$1===messages&&(messages$1=newMessages()),deepMerge(messages$1,options.messages),options.messages=messages$1}else options.messages=this.messages();var arr,value,series={},keys=options.keys||Object.keys(this.rules);keys.forEach(function(z){arr=_this.rules[z],value=source[z],arr.forEach(function(r){var rule=r;"function"==typeof rule.transform&&(source===source_&&(source=_extends({},source)),value=source[z]=rule.transform(value)),rule="function"==typeof rule?{validator:rule}:_extends({},rule),rule.validator=_this.getValidationMethod(rule),rule.field=z,rule.fullField=rule.fullField||z,rule.type=_this.getType(rule),rule.validator&&(series[z]=series[z]||[],series[z].push({rule:rule,value:value,source:source,field:z}))})});var errorFields={};return asyncMap(series,options,function(data,doIt){function addFullfield(key,schema){return _extends(_extends({},schema),{},{fullField:rule.fullField+"."+key})}function cb(e){void 0===e&&(e=[]);var errors=e;if(Array.isArray(errors)||(errors=[errors]),!options.suppressWarning&&errors.length&&Schema.warning("async-validator:",errors),errors.length&&void 0!==rule.message&&(errors=[].concat(rule.message)),errors=errors.map(complementError(rule)),options.first&&errors.length)return errorFields[rule.field]=1,doIt(errors);if(!deep)doIt(errors);else{if(rule.required&&!data.value)return void 0===rule.message?options.error&&(errors=[options.error(rule,format(options.messages.required,rule.field))]):errors=[].concat(rule.message).map(complementError(rule)),doIt(errors);var fieldsSchema={};if(rule.defaultField)for(var k in data.value)data.value.hasOwnProperty(k)&&(fieldsSchema[k]=rule.defaultField);for(var f in fieldsSchema=_extends(_extends({},fieldsSchema),data.rule.fields),fieldsSchema)if(fieldsSchema.hasOwnProperty(f)){var fieldSchema=Array.isArray(fieldsSchema[f])?fieldsSchema[f]:[fieldsSchema[f]];fieldsSchema[f]=fieldSchema.map(addFullfield.bind(null,f))}var schema=new Schema(fieldsSchema);schema.messages(options.messages),data.rule.options&&(data.rule.options.messages=options.messages,data.rule.options.error=options.error),schema.validate(data.value,data.rule.options||options,function(errs){var finalErrors=[];errors&&errors.length&&finalErrors.push.apply(finalErrors,errors),errs&&errs.length&&finalErrors.push.apply(finalErrors,errs),doIt(finalErrors.length?finalErrors:null)})}}var rule=data.rule,deep=("object"===rule.type||"array"===rule.type)&&("object"==typeof rule.fields||"object"==typeof rule.defaultField);deep=deep&&(rule.required||!rule.required&&data.value),rule.field=data.field;var res;rule.asyncValidator?res=rule.asyncValidator(rule,data.value,cb,data.source,options):rule.validator&&(res=rule.validator(rule,data.value,cb,data.source,options),!0===res?cb():!1===res?cb(rule.message||rule.field+" fails"):res instanceof Array?cb(res):res instanceof Error&&cb(res.message)),res&&res.then&&res.then(function(){return cb()},function(e){return cb(e)})},function(results){complete(results)})},getType:function getType(rule){if(void 0===rule.type&&rule.pattern instanceof RegExp&&(rule.type="pattern"),"function"!=typeof rule.validator&&rule.type&&!validators.hasOwnProperty(rule.type))throw new Error(format("Unknown rule type %s",rule.type));return rule.type||"string"},getValidationMethod:function getValidationMethod(rule){if("function"==typeof rule.validator)return rule.validator;var keys=Object.keys(rule),messageIndex=keys.indexOf("message");return-1!==messageIndex&&keys.splice(messageIndex,1),1===keys.length&&"required"===keys[0]?validators.required:validators[this.getType(rule)]||!1}},Schema.register=function register(type,validator){if("function"!=typeof validator)throw new Error("Cannot register a validator by type, validator is not a function");validators[type]=validator},Schema.warning=warning,Schema.messages=messages,Schema.validators=validators;export default Schema;