function getError(option,xhr){var msg="cannot ".concat(option.method," ").concat(option.action," ").concat(xhr.status,"'"),err=new Error(msg);return err.status=xhr.status,err.method=option.method,err.url=option.action,err}function getBody(xhr){var text=xhr.responseText||xhr.response;if(!text)return text;try{return JSON.parse(text)}catch(e){return text}}export default function upload(option){var xhr=new XMLHttpRequest;option.onProgress&&xhr.upload&&(xhr.upload.onprogress=function progress(e){0<e.total&&(e.percent=100*(e.loaded/e.total)),option.onProgress(e)});var formData=new FormData;option.data&&Object.keys(option.data).forEach(function(key){var value=option.data[key];return Array.isArray(value)?void value.forEach(function(item){formData.append("".concat(key,"[]"),item)}):void formData.append(key,option.data[key])}),option.file instanceof Blob?formData.append(option.filename,option.file,option.file.name):formData.append(option.filename,option.file),xhr.onerror=function error(e){option.onError(e)},xhr.onload=function onload(){return 200>xhr.status||300<=xhr.status?option.onError(getError(option,xhr),getBody(xhr)):option.onSuccess(getBody(xhr),xhr)},xhr.open(option.method,option.action,!0),option.withCredentials&&"withCredentials"in xhr&&(xhr.withCredentials=!0);var headers=option.headers||{};return null!==headers["X-Requested-With"]&&xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(headers).forEach(function(h){null!==headers[h]&&xhr.setRequestHeader(h,headers[h])}),xhr.send(formData),{abort:function abort(){xhr.abort()}}}