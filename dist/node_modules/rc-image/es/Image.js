import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _objectSpread from"/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _slicedToArray from"/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _typeof from"/node_modules/@babel/runtime/helpers/esm/typeof.js";import _objectWithoutProperties from"/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js";import React from"c:\\node_modules\\react\\index.js";import{useState}from"c:\\node_modules\\react\\index.js";import cn from"/node_modules/classnames.js";import{getOffset}from"/node_modules/rc-util/es/Dom/css.js";import useMergedState from"/node_modules/rc-util/es/hooks/useMergedState.js";import Preview from"/node_modules/rc-image/es/Preview.js";import PreviewGroup,{context}from"/node_modules/rc-image/es/PreviewGroup.js";var uuid=0,ImageInternal=function ImageInternal(_ref){var imgSrc=_ref.src,alt=_ref.alt,onInitialPreviewClose=_ref.onPreviewClose,_ref$prefixCls=_ref.prefixCls,prefixCls=void 0===_ref$prefixCls?"rc-image":_ref$prefixCls,_ref$previewPrefixCls=_ref.previewPrefixCls,previewPrefixCls=void 0===_ref$previewPrefixCls?"".concat(prefixCls,"-preview"):_ref$previewPrefixCls,placeholder=_ref.placeholder,fallback=_ref.fallback,width=_ref.width,height=_ref.height,style=_ref.style,_ref$preview=_ref.preview,preview=!(void 0!==_ref$preview)||_ref$preview,className=_ref.className,onClick=_ref.onClick,wrapperClassName=_ref.wrapperClassName,wrapperStyle=_ref.wrapperStyle,crossOrigin=_ref.crossOrigin,decoding=_ref.decoding,loading=_ref.loading,referrerPolicy=_ref.referrerPolicy,sizes=_ref.sizes,srcSet=_ref.srcSet,useMap=_ref.useMap,otherProps=_objectWithoutProperties(_ref,["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","wrapperClassName","wrapperStyle","crossOrigin","decoding","loading","referrerPolicy","sizes","srcSet","useMap"]),isCustomPlaceholder=placeholder&&!0!==placeholder,_ref2="object"===_typeof(preview)?preview:{},previewSrc=_ref2.src,_ref2$visible=_ref2.visible,previewVisible=void 0===_ref2$visible?void 0:_ref2$visible,_ref2$onVisibleChange=_ref2.onVisibleChange,onPreviewVisibleChange=void 0===_ref2$onVisibleChange?onInitialPreviewClose:_ref2$onVisibleChange,_ref2$getContainer=_ref2.getContainer,getPreviewContainer=void 0===_ref2$getContainer?void 0:_ref2$getContainer,previewMask=_ref2.mask,maskClassName=_ref2.maskClassName,icons=_ref2.icons,src=null!==previewSrc&&void 0!==previewSrc?previewSrc:imgSrc,isControlled=previewVisible!==void 0,_useMergedState=useMergedState(!!previewVisible,{value:previewVisible,onChange:onPreviewVisibleChange}),_useMergedState2=_slicedToArray(_useMergedState,2),isShowPreview=_useMergedState2[0],setShowPreview=_useMergedState2[1],_useState=useState(isCustomPlaceholder?"loading":"normal"),_useState2=_slicedToArray(_useState,2),status=_useState2[0],setStatus=_useState2[1],_useState3=useState(null),_useState4=_slicedToArray(_useState3,2),mousePosition=_useState4[0],setMousePosition=_useState4[1],isError="error"===status,_React$useContext=React.useContext(context),isPreviewGroup=_React$useContext.isPreviewGroup,setCurrent=_React$useContext.setCurrent,setGroupShowPreview=_React$useContext.setShowPreview,setGroupMousePosition=_React$useContext.setMousePosition,registerImage=_React$useContext.registerImage,_React$useState=React.useState(function(){return uuid+=1,uuid}),_React$useState2=_slicedToArray(_React$useState,1),currentId=_React$useState2[0],canPreview=preview&&!isError,onLoad=function onLoad(){setStatus("normal")};React.useEffect(function(){var unRegister=registerImage(currentId,src);return unRegister},[]),React.useEffect(function(){var unRegister=registerImage(currentId,src);canPreview||unRegister()},[src,canPreview]),React.useEffect(function(){isCustomPlaceholder&&setStatus("loading")},[imgSrc]);var wrapperClass=cn(prefixCls,wrapperClassName,_defineProperty({},"".concat(prefixCls,"-error"),isError)),mergedSrc=isError&&fallback?fallback:src,imgCommonProps={crossOrigin:crossOrigin,decoding:decoding,loading:loading,referrerPolicy:referrerPolicy,sizes:sizes,srcSet:srcSet,useMap:useMap,alt:alt,className:cn("".concat(prefixCls,"-img"),_defineProperty({},"".concat(prefixCls,"-img-placeholder"),!0===placeholder),className),style:_objectSpread({height:height},style)};return React.createElement(React.Fragment,null,React.createElement("div",_extends({},otherProps,{className:wrapperClass,onClick:preview&&!isError?function onPreview(e){if(!isControlled){var _getOffset=getOffset(e.target),left=_getOffset.left,top=_getOffset.top;isPreviewGroup?(setCurrent(currentId),setGroupMousePosition({x:left,y:top})):setMousePosition({x:left,y:top})}isPreviewGroup?setGroupShowPreview(!0):setShowPreview(!0),onClick&&onClick(e)}:onClick,style:_objectSpread({width:width,height:height},wrapperStyle)}),React.createElement("img",_extends({},imgCommonProps,{ref:function getImgRef(img){"loading"!==status||(null===img||void 0===img?void 0:img.complete)&&(img.naturalWidth||img.naturalHeight)&&onLoad()}},isError&&fallback?{src:fallback}:{onLoad:onLoad,onError:function onError(){setStatus("error")},src:imgSrc})),"loading"===status&&React.createElement("div",{"aria-hidden":"true",className:"".concat(prefixCls,"-placeholder")},placeholder),previewMask&&canPreview&&React.createElement("div",{className:cn("".concat(prefixCls,"-mask"),maskClassName)},previewMask)),!isPreviewGroup&&canPreview&&React.createElement(Preview,{"aria-hidden":!isShowPreview,visible:isShowPreview,prefixCls:previewPrefixCls,onClose:function onPreviewClose(e){e.stopPropagation(),setShowPreview(!1),isControlled||setMousePosition(null)},mousePosition:mousePosition,src:mergedSrc,alt:alt,getContainer:getPreviewContainer,icons:icons}))};ImageInternal.PreviewGroup=PreviewGroup,ImageInternal.displayName="Image";export default ImageInternal;