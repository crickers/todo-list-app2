import"/node_modules/core-js/modules/es.array.index-of.js";import"/node_modules/core-js/modules/es.array.iterator.js";import"/node_modules/core-js/modules/web.dom-collections.iterator.js";import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _objectSpread from"/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _slicedToArray from"/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _objectWithoutProperties from"/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js";import React from"c:\\node_modules\\react\\index.js";import Dialog from"/node_modules/rc-dialog.js";import classnames from"/node_modules/classnames.js";import addEventListener from"/node_modules/rc-util/es/Dom/addEventListener.js";import{getOffset}from"/node_modules/rc-util/es/Dom/css.js";import{warning}from"/node_modules/rc-util/es/warning.js";import useFrameSetState from"/node_modules/rc-image/es/hooks/useFrameSetState.js";import getFixScaleEleTransPosition from"/node_modules/rc-image/es/getFixScaleEleTransPosition.js";import{context}from"/node_modules/rc-image/es/PreviewGroup.js";var useState=React.useState,useEffect=React.useEffect,initialPosition={x:0,y:0},Preview=function Preview(props){var prefixCls=props.prefixCls,src=props.src,alt=props.alt,onClose=props.onClose,afterClose=props.afterClose,visible=props.visible,_props$icons=props.icons,icons=void 0===_props$icons?{}:_props$icons,restProps=_objectWithoutProperties(props,["prefixCls","src","alt","onClose","afterClose","visible","icons"]),rotateLeft=icons.rotateLeft,rotateRight=icons.rotateRight,zoomIn=icons.zoomIn,zoomOut=icons.zoomOut,close=icons.close,left=icons.left,right=icons.right,_useState=useState(1),_useState2=_slicedToArray(_useState,2),scale=_useState2[0],setScale=_useState2[1],_useState3=useState(0),_useState4=_slicedToArray(_useState3,2),rotate=_useState4[0],setRotate=_useState4[1],_useFrameSetState=useFrameSetState(initialPosition),_useFrameSetState2=_slicedToArray(_useFrameSetState,2),position=_useFrameSetState2[0],setPosition=_useFrameSetState2[1],imgRef=React.useRef(),originPositionRef=React.useRef({originX:0,originY:0,deltaX:0,deltaY:0}),_React$useState=React.useState(!1),_React$useState2=_slicedToArray(_React$useState,2),isMoving=_React$useState2[0],setMoving=_React$useState2[1],_React$useContext=React.useContext(context),previewUrls=_React$useContext.previewUrls,current=_React$useContext.current,isPreviewGroup=_React$useContext.isPreviewGroup,setCurrent=_React$useContext.setCurrent,previewGroupCount=previewUrls.size,previewUrlsKeys=Array.from(previewUrls.keys()),currentPreviewIndex=previewUrlsKeys.indexOf(current),combinationSrc=isPreviewGroup?previewUrls.get(current):src,showLeftOrRightSwitches=isPreviewGroup&&1<previewGroupCount,_React$useState3=React.useState({wheelDirection:0}),_React$useState4=_slicedToArray(_React$useState3,2),lastWheelZoomDirection=_React$useState4[0],setLastWheelZoomDirection=_React$useState4[1],onZoomIn=function onZoomIn(){setScale(function(value){return value+1}),setPosition(initialPosition)},onZoomOut=function onZoomOut(){1<scale&&setScale(function(value){return value-1}),setPosition(initialPosition)},wrapClassName=classnames(_defineProperty({},"".concat(prefixCls,"-moving"),isMoving)),toolClassName="".concat(prefixCls,"-operations-operation"),iconClassName="".concat(prefixCls,"-operations-icon"),onMouseUp=function onMouseUp(){if(visible&&isMoving){var width=imgRef.current.offsetWidth*scale,height=imgRef.current.offsetHeight*scale,_getOffset=getOffset(imgRef.current),_left=_getOffset.left,top=_getOffset.top,isRotate=0!=rotate%180;setMoving(!1);var fixState=getFixScaleEleTransPosition(isRotate?height:width,isRotate?width:height,_left,top);fixState&&setPosition(_objectSpread({},fixState))}},onMouseMove=function onMouseMove(event){visible&&isMoving&&setPosition({x:event.pageX-originPositionRef.current.deltaX,y:event.pageY-originPositionRef.current.deltaY})},onWheelMove=function onWheelMove(event){if(visible){event.preventDefault();var wheelDirection=event.deltaY;setLastWheelZoomDirection({wheelDirection:wheelDirection})}};return useEffect(function(){var wheelDirection=lastWheelZoomDirection.wheelDirection;0<wheelDirection?onZoomOut():0>wheelDirection&&onZoomIn()},[lastWheelZoomDirection]),useEffect(function(){var onTopMouseUpListener,onTopMouseMoveListener,onMouseUpListener=addEventListener(window,"mouseup",onMouseUp,!1),onMouseMoveListener=addEventListener(window,"mousemove",onMouseMove,!1),onScrollWheelListener=addEventListener(window,"wheel",onWheelMove,{passive:!1});try{window.top!==window.self&&(onTopMouseUpListener=addEventListener(window.top,"mouseup",onMouseUp,!1),onTopMouseMoveListener=addEventListener(window.top,"mousemove",onMouseMove,!1))}catch(error){warning(!1,"[rc-image] ".concat(error))}return function(){onMouseUpListener.remove(),onMouseMoveListener.remove(),onScrollWheelListener.remove(),onTopMouseUpListener&&onTopMouseUpListener.remove(),onTopMouseMoveListener&&onTopMouseMoveListener.remove()}},[visible,isMoving]),React.createElement(Dialog,_extends({},restProps,{transitionName:"zoom",maskTransitionName:"fade",closable:!1,keyboard:!0,prefixCls:prefixCls,onClose:onClose,afterClose:function onAfterClose(){setScale(1),setRotate(0),setPosition(initialPosition)},visible:visible,wrapClassName:wrapClassName}),React.createElement("ul",{className:"".concat(prefixCls,"-operations")},[{icon:close,onClick:onClose,type:"close"},{icon:zoomIn,onClick:onZoomIn,type:"zoomIn"},{icon:zoomOut,onClick:onZoomOut,type:"zoomOut",disabled:1===scale},{icon:rotateRight,onClick:function onRotateRight(){setRotate(function(value){return value+90})},type:"rotateRight"},{icon:rotateLeft,onClick:function onRotateLeft(){setRotate(function(value){return value-90})},type:"rotateLeft"}].map(function(_ref){var icon=_ref.icon,onClick=_ref.onClick,type=_ref.type,disabled=_ref.disabled;return React.createElement("li",{className:classnames(toolClassName,_defineProperty({},"".concat(prefixCls,"-operations-operation-disabled"),!!disabled)),onClick:onClick,key:type},React.isValidElement(icon)?React.cloneElement(icon,{className:iconClassName}):icon)})),React.createElement("div",{className:"".concat(prefixCls,"-img-wrapper"),style:{transform:"translate3d(".concat(position.x,"px, ").concat(position.y,"px, 0)")}},React.createElement("img",{onMouseDown:function onMouseDown(event){0!==event.button||(event.preventDefault(),event.stopPropagation(),originPositionRef.current.deltaX=event.pageX-position.x,originPositionRef.current.deltaY=event.pageY-position.y,originPositionRef.current.originX=position.x,originPositionRef.current.originY=position.y,setMoving(!0))},ref:imgRef,className:"".concat(prefixCls,"-img"),src:combinationSrc,alt:alt,style:{transform:"scale3d(".concat(scale,", ").concat(scale,", 1) rotate(").concat(rotate,"deg)")}})),showLeftOrRightSwitches&&React.createElement("div",{className:classnames("".concat(prefixCls,"-switch-left"),_defineProperty({},"".concat(prefixCls,"-switch-left-disabled"),0===currentPreviewIndex)),onClick:function onSwitchLeft(event){event.preventDefault(),event.stopPropagation(),0<currentPreviewIndex&&setCurrent(previewUrlsKeys[currentPreviewIndex-1])}},left),showLeftOrRightSwitches&&React.createElement("div",{className:classnames("".concat(prefixCls,"-switch-right"),_defineProperty({},"".concat(prefixCls,"-switch-right-disabled"),currentPreviewIndex===previewGroupCount-1)),onClick:function onSwitchRight(event){event.preventDefault(),event.stopPropagation(),currentPreviewIndex<previewGroupCount-1&&setCurrent(previewUrlsKeys[currentPreviewIndex+1])}},right))};export default Preview;