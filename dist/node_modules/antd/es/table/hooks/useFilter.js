import"/node_modules/core-js/modules/es.array.reduce.js";import"/node_modules/core-js/modules/es.string.includes.js";import _slicedToArray from"/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _toConsumableArray from"/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import React from"c:\\node_modules\\react\\index.js";import{getColumnPos,renderColumnTitle,getColumnKey}from"/node_modules/antd/es/table/util.js";import FilterDropdown from"/node_modules/antd/es/table/hooks/useFilter/FilterDropdown.js";function collectFilterStates(columns,init,pos){var filterStates=[];return(columns||[]).forEach(function(column,index){var _a,columnPos=getColumnPos(index,pos);if("children"in column)filterStates=[].concat(_toConsumableArray(filterStates),_toConsumableArray(collectFilterStates(column.children,init,columnPos)));else if(column.filters||"filterDropdown"in column||"onFilter"in column)if("filteredValue"in column){var filteredValues=column.filteredValue;"filterDropdown"in column||(filteredValues=null!==(_a=null===filteredValues||void 0===filteredValues?void 0:filteredValues.map(String))&&void 0!==_a?_a:filteredValues),filterStates.push({column:column,key:getColumnKey(column,columnPos),filteredKeys:filteredValues,forceFiltered:column.filtered})}else filterStates.push({column:column,key:getColumnKey(column,columnPos),filteredKeys:init&&column.defaultFilteredValue?column.defaultFilteredValue:void 0,forceFiltered:column.filtered})}),filterStates}function injectFilter(prefixCls,dropdownPrefixCls,columns,filterStates,triggerFilter,getPopupContainer,locale,pos){return columns.map(function(column,index){var columnPos=getColumnPos(index,pos),_column$filterMultipl=column.filterMultiple,filterMultiple=void 0===_column$filterMultipl||_column$filterMultipl,newColumn=column;if(newColumn.filters||newColumn.filterDropdown){var columnKey=getColumnKey(newColumn,columnPos),filterState=filterStates.find(function(_ref){var key=_ref.key;return columnKey===key});newColumn=_extends(_extends({},newColumn),{title:function title(renderProps){return React.createElement(FilterDropdown,{prefixCls:"".concat(prefixCls,"-filter"),dropdownPrefixCls:dropdownPrefixCls,column:newColumn,columnKey:columnKey,filterState:filterState,filterMultiple:filterMultiple,triggerFilter:triggerFilter,locale:locale,getPopupContainer:getPopupContainer},renderColumnTitle(column.title,renderProps))}})}return"children"in newColumn&&(newColumn=_extends(_extends({},newColumn),{children:injectFilter(prefixCls,dropdownPrefixCls,newColumn.children,filterStates,triggerFilter,getPopupContainer,locale,columnPos)})),newColumn})}function flattenKeys(filters){var keys=[];return(filters||[]).forEach(function(_ref2){var value=_ref2.value,children=_ref2.children;keys.push(value),children&&(keys=[].concat(_toConsumableArray(keys),_toConsumableArray(flattenKeys(children))))}),keys}function generateFilterInfo(filterStates){var currentFilters={};return filterStates.forEach(function(_ref3){var key=_ref3.key,filteredKeys=_ref3.filteredKeys,column=_ref3.column,filters=column.filters,filterDropdown=column.filterDropdown;if(filterDropdown)currentFilters[key]=filteredKeys||null;else if(Array.isArray(filteredKeys)){var keys=flattenKeys(filters);currentFilters[key]=keys.filter(function(originKey){return filteredKeys.includes(originKey+"")})}else currentFilters[key]=null}),currentFilters}export function getFilterData(data,filterStates){return filterStates.reduce(function(currentData,filterState){var _filterState$column=filterState.column,onFilter=_filterState$column.onFilter,filters=_filterState$column.filters,filteredKeys=filterState.filteredKeys;return onFilter&&filteredKeys&&filteredKeys.length?currentData.filter(function(record){return filteredKeys.some(function(key){var keys=flattenKeys(filters),keyIndex=keys.findIndex(function(k){return k+""===key+""}),realKey=-1===keyIndex?key:keys[keyIndex];return onFilter(realKey,record)})}):currentData},data)}function useFilter(_ref4){var prefixCls=_ref4.prefixCls,dropdownPrefixCls=_ref4.dropdownPrefixCls,mergedColumns=_ref4.mergedColumns,onFilterChange=_ref4.onFilterChange,getPopupContainer=_ref4.getPopupContainer,tableLocale=_ref4.locale,_React$useState=React.useState(collectFilterStates(mergedColumns,!0)),_React$useState2=_slicedToArray(_React$useState,2),filterStates=_React$useState2[0],setFilterStates=_React$useState2[1],mergedFilterStates=React.useMemo(function(){var collectedStates=collectFilterStates(mergedColumns,!1);return collectedStates.every(function(_ref5){var filteredKeys=_ref5.filteredKeys;return void 0===filteredKeys})?filterStates:collectedStates},[mergedColumns,filterStates]),getFilters=React.useCallback(function(){return generateFilterInfo(mergedFilterStates)},[mergedFilterStates]),triggerFilter=function triggerFilter(filterState){var newFilterStates=mergedFilterStates.filter(function(_ref6){var key=_ref6.key;return key!==filterState.key});newFilterStates.push(filterState),setFilterStates(newFilterStates),onFilterChange(generateFilterInfo(newFilterStates),newFilterStates)};return[function transformColumns(innerColumns){return injectFilter(prefixCls,dropdownPrefixCls,innerColumns,mergedFilterStates,triggerFilter,getPopupContainer,tableLocale)},mergedFilterStates,getFilters]}export default useFilter;