import"/node_modules/core-js/modules/es.array.iterator.js";import"/node_modules/core-js/modules/es.array.slice.js";import"/node_modules/core-js/modules/esnext.map.delete-all.js";import"/node_modules/core-js/modules/esnext.map.every.js";import"/node_modules/core-js/modules/esnext.map.filter.js";import"/node_modules/core-js/modules/esnext.map.find.js";import"/node_modules/core-js/modules/esnext.map.find-key.js";import"/node_modules/core-js/modules/esnext.map.includes.js";import"/node_modules/core-js/modules/esnext.map.key-of.js";import"/node_modules/core-js/modules/esnext.map.map-keys.js";import"/node_modules/core-js/modules/esnext.map.map-values.js";import"/node_modules/core-js/modules/esnext.map.merge.js";import"/node_modules/core-js/modules/esnext.map.reduce.js";import"/node_modules/core-js/modules/esnext.map.some.js";import"/node_modules/core-js/modules/esnext.map.update.js";import"/node_modules/core-js/modules/esnext.set.add-all.js";import"/node_modules/core-js/modules/esnext.set.delete-all.js";import"/node_modules/core-js/modules/esnext.set.difference.js";import"/node_modules/core-js/modules/esnext.set.every.js";import"/node_modules/core-js/modules/esnext.set.filter.js";import"/node_modules/core-js/modules/esnext.set.find.js";import"/node_modules/core-js/modules/esnext.set.intersection.js";import"/node_modules/core-js/modules/esnext.set.is-disjoint-from.js";import"/node_modules/core-js/modules/esnext.set.is-subset-of.js";import"/node_modules/core-js/modules/esnext.set.is-superset-of.js";import"/node_modules/core-js/modules/esnext.set.join.js";import"/node_modules/core-js/modules/esnext.set.map.js";import"/node_modules/core-js/modules/esnext.set.reduce.js";import"/node_modules/core-js/modules/esnext.set.some.js";import"/node_modules/core-js/modules/esnext.set.symmetric-difference.js";import"/node_modules/core-js/modules/esnext.set.union.js";import"/node_modules/core-js/modules/web.dom-collections.iterator.js";import _toArray from"/node_modules/@babel/runtime/helpers/esm/toArray.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _slicedToArray from"/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _toConsumableArray from"/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import _typeof from"/node_modules/@babel/runtime/helpers/esm/typeof.js";import React from"c:\\node_modules\\react\\index.js";import{useState,useCallback,useMemo}from"c:\\node_modules\\react\\index.js";import DownOutlined from"/node_modules/@ant-design/icons/es/icons/DownOutlined.js";import{convertDataToEntities}from"/node_modules/rc-tree/es/utils/treeUtil.js";import{conductCheck}from"/node_modules/rc-tree/es/utils/conductUtil.js";import{arrAdd,arrDel}from"/node_modules/rc-tree/es/util.js";import{INTERNAL_COL_DEFINE}from"/node_modules/rc-table.js";import useMergedState from"/node_modules/rc-util/es/hooks/useMergedState.js";import Checkbox from"/node_modules/antd/es/checkbox.js";import Dropdown from"/node_modules/antd/es/dropdown.js";import Menu from"/node_modules/antd/es/menu.js";import Radio from"/node_modules/antd/es/radio.js";import devWarning from"/node_modules/antd/es/_util/devWarning.js";export var SELECTION_ALL="SELECT_ALL";export var SELECTION_INVERT="SELECT_INVERT";export var SELECTION_NONE="SELECT_NONE";function getFixedType(column){return column&&column.fixed}function flattenData(data,childrenColumnName){var list=[];return(data||[]).forEach(function(record){list.push(record),record&&"object"===_typeof(record)&&childrenColumnName in record&&(list=[].concat(_toConsumableArray(list),_toConsumableArray(flattenData(record[childrenColumnName],childrenColumnName))))}),list}export default function useSelection(rowSelection,config){var _ref=rowSelection||{},preserveSelectedRowKeys=_ref.preserveSelectedRowKeys,selectedRowKeys=_ref.selectedRowKeys,getCheckboxProps=_ref.getCheckboxProps,onSelectionChange=_ref.onChange,onSelect=_ref.onSelect,onSelectAll=_ref.onSelectAll,onSelectInvert=_ref.onSelectInvert,onSelectNone=_ref.onSelectNone,onSelectMultiple=_ref.onSelectMultiple,selectionColWidth=_ref.columnWidth,selectionType=_ref.type,selections=_ref.selections,fixed=_ref.fixed,customizeRenderCell=_ref.renderCell,hideSelectAll=_ref.hideSelectAll,_ref$checkStrictly=_ref.checkStrictly,checkStrictly=!(void 0!==_ref$checkStrictly)||_ref$checkStrictly,prefixCls=config.prefixCls,data=config.data,pageData=config.pageData,getRecordByKey=config.getRecordByKey,getRowKey=config.getRowKey,expandType=config.expandType,childrenColumnName=config.childrenColumnName,tableLocale=config.locale,expandIconColumnIndex=config.expandIconColumnIndex,getPopupContainer=config.getPopupContainer,preserveRecordsRef=React.useRef(new Map),_useMergedState=useMergedState(selectedRowKeys||[],{value:selectedRowKeys}),_useMergedState2=_slicedToArray(_useMergedState,2),mergedSelectedKeys=_useMergedState2[0],setMergedSelectedKeys=_useMergedState2[1],_useMemo=useMemo(function(){return checkStrictly?{keyEntities:null}:convertDataToEntities(data,{externalGetKey:getRowKey,childrenPropName:childrenColumnName})},[data,getRowKey,checkStrictly,childrenColumnName]),keyEntities=_useMemo.keyEntities,flattedData=useMemo(function(){return flattenData(pageData,childrenColumnName)},[pageData,childrenColumnName]),checkboxPropsMap=useMemo(function(){var map=new Map;return flattedData.forEach(function(record,index){var key=getRowKey(record,index),checkboxProps=(getCheckboxProps?getCheckboxProps(record):null)||{};map.set(key,checkboxProps)}),map},[flattedData,getRowKey,getCheckboxProps]),isCheckboxDisabled=useCallback(function(r){var _a;return!(!(null!==(_a=checkboxPropsMap.get(getRowKey(r)))&&void 0!==_a)||!_a.disabled)},[checkboxPropsMap,getRowKey]),_useMemo2=useMemo(function(){if(checkStrictly)return[mergedSelectedKeys||[],[]];var _conductCheck=conductCheck(mergedSelectedKeys,!0,keyEntities,isCheckboxDisabled),checkedKeys=_conductCheck.checkedKeys,halfCheckedKeys=_conductCheck.halfCheckedKeys;return[checkedKeys||[],halfCheckedKeys]},[mergedSelectedKeys,checkStrictly,keyEntities,isCheckboxDisabled]),_useMemo3=_slicedToArray(_useMemo2,2),derivedSelectedKeys=_useMemo3[0],derivedHalfSelectedKeys=_useMemo3[1],derivedSelectedKeySet=useMemo(function(){var keys="radio"===selectionType?derivedSelectedKeys.slice(0,1):derivedSelectedKeys;return new Set(keys)},[derivedSelectedKeys,selectionType]),derivedHalfSelectedKeySet=useMemo(function(){return"radio"===selectionType?new Set:new Set(derivedHalfSelectedKeys)},[derivedHalfSelectedKeys,selectionType]),_useState=useState(null),_useState2=_slicedToArray(_useState,2),lastSelectedKey=_useState2[0],setLastSelectedKey=_useState2[1];React.useEffect(function(){rowSelection||setMergedSelectedKeys([])},[!!rowSelection]);var setSelectedKeys=useCallback(function(keys){var availableKeys,records;if(preserveSelectedRowKeys){var newCache=new Map;availableKeys=keys,records=keys.map(function(key){var record=getRecordByKey(key);return!record&&preserveRecordsRef.current.has(key)&&(record=preserveRecordsRef.current.get(key)),newCache.set(key,record),record}),preserveRecordsRef.current=newCache}else availableKeys=[],records=[],keys.forEach(function(key){var record=getRecordByKey(key);void 0!==record&&(availableKeys.push(key),records.push(record))});setMergedSelectedKeys(availableKeys),onSelectionChange&&onSelectionChange(availableKeys,records)},[setMergedSelectedKeys,getRecordByKey,onSelectionChange,preserveSelectedRowKeys]),triggerSingleSelection=useCallback(function(key,selected,keys,event){if(onSelect){var rows=keys.map(function(k){return getRecordByKey(k)});onSelect(getRecordByKey(key),selected,rows,event)}setSelectedKeys(keys)},[onSelect,getRecordByKey,setSelectedKeys]),mergedSelections=useMemo(function(){if(!selections||hideSelectAll)return null;var selectionList=!0===selections?[SELECTION_ALL,SELECTION_INVERT,SELECTION_NONE]:selections;return selectionList.map(function(selection){return selection===SELECTION_ALL?{key:"all",text:tableLocale.selectionAll,onSelect:function onSelect(){setSelectedKeys(data.map(function(record,index){return getRowKey(record,index)}))}}:selection===SELECTION_INVERT?{key:"invert",text:tableLocale.selectInvert,onSelect:function onSelect(){var keySet=new Set(derivedSelectedKeySet);pageData.forEach(function(record,index){var key=getRowKey(record,index);keySet.has(key)?keySet["delete"](key):keySet.add(key)});var keys=Array.from(keySet);setSelectedKeys(keys),onSelectInvert&&(devWarning(!1,"Table","`onSelectInvert` will be removed in future. Please use `onChange` instead."),onSelectInvert(keys))}}:selection===SELECTION_NONE?{key:"none",text:tableLocale.selectNone,onSelect:function onSelect(){setSelectedKeys([]),onSelectNone&&onSelectNone()}}:selection})},[selections,derivedSelectedKeySet,pageData,getRowKey,onSelectInvert,setSelectedKeys]),transformColumns=useCallback(function(columns){if(!rowSelection)return columns;var title,keySet=new Set(derivedSelectedKeySet),recordKeys=flattedData.map(getRowKey).filter(function(key){return!checkboxPropsMap.get(key).disabled}),checkedCurrentAll=recordKeys.every(function(key){return keySet.has(key)}),checkedCurrentSome=recordKeys.some(function(key){return keySet.has(key)}),onSelectAllChange=function onSelectAllChange(){var changeKeys=[];checkedCurrentAll?recordKeys.forEach(function(key){keySet["delete"](key),changeKeys.push(key)}):recordKeys.forEach(function(key){keySet.has(key)||(keySet.add(key),changeKeys.push(key))});var keys=Array.from(keySet);setSelectedKeys(keys),onSelectAll&&onSelectAll(!checkedCurrentAll,keys.map(function(k){return getRecordByKey(k)}),changeKeys.map(function(k){return getRecordByKey(k)}))};if("radio"!==selectionType){var customizeSelections;if(mergedSelections){var menu=React.createElement(Menu,{getPopupContainer:getPopupContainer},mergedSelections.map(function(selection,index){var key=selection.key,text=selection.text,onSelectionClick=selection.onSelect;return React.createElement(Menu.Item,{key:key||index,onClick:function onClick(){onSelectionClick&&onSelectionClick(recordKeys)}},text)}));customizeSelections=React.createElement("div",{className:"".concat(prefixCls,"-selection-extra")},React.createElement(Dropdown,{overlay:menu,getPopupContainer:getPopupContainer},React.createElement("span",null,React.createElement(DownOutlined,null))))}var allDisabled=flattedData.every(function(record,index){var key=getRowKey(record,index),checkboxProps=checkboxPropsMap.get(key)||{};return checkboxProps.disabled});title=!hideSelectAll&&React.createElement("div",{className:"".concat(prefixCls,"-selection")},React.createElement(Checkbox,{checked:!allDisabled&&!!flattedData.length&&checkedCurrentAll,indeterminate:!checkedCurrentAll&&checkedCurrentSome,onChange:onSelectAllChange,disabled:0===flattedData.length||allDisabled,skipGroup:!0}),customizeSelections)}var renderCell;renderCell="radio"===selectionType?function renderCell(_,record,index){var key=getRowKey(record,index),checked=keySet.has(key);return{node:React.createElement(Radio,_extends({},checkboxPropsMap.get(key),{checked:checked,onClick:function onClick(e){return e.stopPropagation()},onChange:function onChange(event){keySet.has(key)||triggerSingleSelection(key,!0,[key],event.nativeEvent)}})),checked:checked}}:function renderCell(_,record,index){var _a,mergedIndeterminate,key=getRowKey(record,index),checked=keySet.has(key),indeterminate=derivedHalfSelectedKeySet.has(key),checkboxProps=checkboxPropsMap.get(key);return"nest"===expandType?(mergedIndeterminate=indeterminate,devWarning("boolean"!=typeof(null===checkboxProps||void 0===checkboxProps?void 0:checkboxProps.indeterminate),"Table","set `indeterminate` using `rowSelection.getCheckboxProps` is not allowed with tree structured dataSource.")):mergedIndeterminate=null!==(_a=null===checkboxProps||void 0===checkboxProps?void 0:checkboxProps.indeterminate)&&void 0!==_a?_a:indeterminate,{node:React.createElement(Checkbox,_extends({},checkboxProps,{indeterminate:mergedIndeterminate,checked:checked,skipGroup:!0,onClick:function onClick(e){return e.stopPropagation()},onChange:function onChange(_ref2){var nativeEvent=_ref2.nativeEvent,shiftKey=nativeEvent.shiftKey,startIndex=-1,endIndex=-1;if(shiftKey&&checkStrictly){var pointKeys=new Set([lastSelectedKey,key]);recordKeys.some(function(recordKey,recordIndex){if(pointKeys.has(recordKey))if(-1===startIndex)startIndex=recordIndex;else return endIndex=recordIndex,!0;return!1})}if(-1!==endIndex&&startIndex!==endIndex&&checkStrictly){var rangeKeys=recordKeys.slice(startIndex,endIndex+1),changedKeys=[];checked?rangeKeys.forEach(function(recordKey){keySet.has(recordKey)&&(changedKeys.push(recordKey),keySet["delete"](recordKey))}):rangeKeys.forEach(function(recordKey){keySet.has(recordKey)||(changedKeys.push(recordKey),keySet.add(recordKey))});var keys=Array.from(keySet);setSelectedKeys(keys),onSelectMultiple&&onSelectMultiple(!checked,keys.map(function(recordKey){return getRecordByKey(recordKey)}),changedKeys.map(function(recordKey){return getRecordByKey(recordKey)}))}else{var originCheckedKeys=derivedSelectedKeys;if(checkStrictly){var checkedKeys=checked?arrDel(originCheckedKeys,key):arrAdd(originCheckedKeys,key);triggerSingleSelection(key,!checked,checkedKeys,nativeEvent)}else{var result=conductCheck([].concat(_toConsumableArray(originCheckedKeys),[key]),!0,keyEntities,isCheckboxDisabled),_checkedKeys=result.checkedKeys,halfCheckedKeys=result.halfCheckedKeys,nextCheckedKeys=_checkedKeys;if(checked){var tempKeySet=new Set(_checkedKeys);tempKeySet["delete"](key),nextCheckedKeys=conductCheck(Array.from(tempKeySet),{checked:!1,halfCheckedKeys:halfCheckedKeys},keyEntities,isCheckboxDisabled).checkedKeys}triggerSingleSelection(key,!checked,nextCheckedKeys,nativeEvent)}}setLastSelectedKey(key)}})),checked:checked}};var renderSelectionCell=function renderSelectionCell(_,record,index){var _renderCell=renderCell(_,record,index),node=_renderCell.node,checked=_renderCell.checked;return customizeRenderCell?customizeRenderCell(checked,record,index,node):node},selectionColumn=_defineProperty({width:selectionColWidth,className:"".concat(prefixCls,"-selection-column"),title:rowSelection.columnTitle||title,render:renderSelectionCell},INTERNAL_COL_DEFINE,{className:"".concat(prefixCls,"-selection-col")});if("row"===expandType&&columns.length&&!expandIconColumnIndex){var _columns=_toArray(columns),expandColumn=_columns[0],restColumns=_columns.slice(1),selectionFixed=fixed||getFixedType(restColumns[0]);return selectionFixed&&(expandColumn.fixed=selectionFixed),[expandColumn,_extends(_extends({},selectionColumn),{fixed:selectionFixed})].concat(_toConsumableArray(restColumns))}return[_extends(_extends({},selectionColumn),{fixed:fixed||getFixedType(columns[0])})].concat(_toConsumableArray(columns))},[getRowKey,flattedData,rowSelection,derivedSelectedKeys,derivedSelectedKeySet,derivedHalfSelectedKeySet,selectionColWidth,mergedSelections,expandType,lastSelectedKey,checkboxPropsMap,onSelectMultiple,triggerSingleSelection,isCheckboxDisabled]);return[transformColumns,derivedSelectedKeySet]}