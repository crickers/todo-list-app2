import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _classCallCheck from"/node_modules/@babel/runtime/helpers/esm/classCallCheck.js";import _createClass from"/node_modules/@babel/runtime/helpers/esm/createClass.js";import _inherits from"/node_modules/@babel/runtime/helpers/esm/inherits.js";import _createSuper from"/node_modules/@babel/runtime/helpers/esm/createSuper.js";import _typeof from"/node_modules/@babel/runtime/helpers/esm/typeof.js";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;0<=i;i--)(d=decorators[i])&&(r=(3>c?d(r):3<c?d(target,key,r):d(target,key))||r);return 3<c&&r&&Object.defineProperty(target,key,r),r};import React from"c:\\node_modules\\react\\index.js";import classNames from"/node_modules/classnames.js";import omit from"/node_modules/rc-util/es/omit.js";import ResizeObserver from"/node_modules/rc-resize-observer.js";import{ConfigContext}from"/node_modules/antd/es/config-provider.js";import{throttleByAnimationFrameDecorator}from"/node_modules/antd/es/_util/throttleByAnimationFrame.js";import{addObserveTarget,removeObserveTarget,getTargetRect,getFixedTop,getFixedBottom}from"/node_modules/antd/es/affix/utils.js";function getDefaultTarget(){return window}var AffixStatus;(function(AffixStatus){AffixStatus[AffixStatus.None=0]="None",AffixStatus[AffixStatus.Prepare=1]="Prepare"})(AffixStatus||(AffixStatus={}));var Affix=function(_React$Component){function Affix(){var _this;return _classCallCheck(this,Affix),_this=_super.apply(this,arguments),_this.state={status:AffixStatus.None,lastAffix:!1,prevTarget:null},_this.getOffsetTop=function(){var offsetBottom=_this.props.offsetBottom,offsetTop=_this.props.offsetTop;return void 0===offsetBottom&&void 0===offsetTop&&(offsetTop=0),offsetTop},_this.getOffsetBottom=function(){return _this.props.offsetBottom},_this.savePlaceholderNode=function(node){_this.placeholderNode=node},_this.saveFixedNode=function(node){_this.fixedNode=node},_this.measure=function(){var _this$state=_this.state,status=_this$state.status,lastAffix=_this$state.lastAffix,onChange=_this.props.onChange,targetFunc=_this.getTargetFunc();if(status===AffixStatus.Prepare&&_this.fixedNode&&_this.placeholderNode&&targetFunc){var offsetTop=_this.getOffsetTop(),offsetBottom=_this.getOffsetBottom(),targetNode=targetFunc();if(targetNode){var newState={status:AffixStatus.None},targetRect=getTargetRect(targetNode),placeholderReact=getTargetRect(_this.placeholderNode),fixedTop=getFixedTop(placeholderReact,targetRect,offsetTop),fixedBottom=getFixedBottom(placeholderReact,targetRect,offsetBottom);void 0===fixedTop?void 0!==fixedBottom&&(newState.affixStyle={position:"fixed",bottom:fixedBottom,width:placeholderReact.width,height:placeholderReact.height},newState.placeholderStyle={width:placeholderReact.width,height:placeholderReact.height}):(newState.affixStyle={position:"fixed",top:fixedTop,width:placeholderReact.width,height:placeholderReact.height},newState.placeholderStyle={width:placeholderReact.width,height:placeholderReact.height}),newState.lastAffix=!!newState.affixStyle,onChange&&lastAffix!==newState.lastAffix&&onChange(newState.lastAffix),_this.setState(newState)}}},_this.prepareMeasure=function(){_this.setState({status:AffixStatus.Prepare,affixStyle:void 0,placeholderStyle:void 0})},_this.render=function(){var getPrefixCls=_this.context.getPrefixCls,_this$state2=_this.state,affixStyle=_this$state2.affixStyle,placeholderStyle=_this$state2.placeholderStyle,_this$props=_this.props,prefixCls=_this$props.prefixCls,children=_this$props.children,className=classNames(_defineProperty({},getPrefixCls("affix",prefixCls),affixStyle)),props=omit(_this.props,["prefixCls","offsetTop","offsetBottom","target","onChange"]);return React.createElement(ResizeObserver,{onResize:function onResize(){_this.updatePosition()}},React.createElement("div",_extends({},props,{ref:_this.savePlaceholderNode}),affixStyle&&React.createElement("div",{style:placeholderStyle,"aria-hidden":"true"}),React.createElement("div",{className:className,ref:_this.saveFixedNode,style:affixStyle},React.createElement(ResizeObserver,{onResize:function onResize(){_this.updatePosition()}},children))))},_this}_inherits(Affix,_React$Component);var _super=_createSuper(Affix);return _createClass(Affix,[{key:"getTargetFunc",value:function getTargetFunc(){var getTargetContainer=this.context.getTargetContainer,target=this.props.target;return void 0===target?getTargetContainer||getDefaultTarget:target}},{key:"componentDidMount",value:function componentDidMount(){var _this2=this,targetFunc=this.getTargetFunc();targetFunc&&(this.timeout=setTimeout(function(){addObserveTarget(targetFunc(),_this2),_this2.updatePosition()}))}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var prevTarget=this.state.prevTarget,targetFunc=this.getTargetFunc(),newTarget=null;targetFunc&&(newTarget=targetFunc()||null),prevTarget!==newTarget&&(removeObserveTarget(this),newTarget&&(addObserveTarget(newTarget,this),this.updatePosition()),this.setState({prevTarget:newTarget})),(prevProps.offsetTop!==this.props.offsetTop||prevProps.offsetBottom!==this.props.offsetBottom)&&this.updatePosition(),this.measure()}},{key:"componentWillUnmount",value:function componentWillUnmount(){clearTimeout(this.timeout),removeObserveTarget(this),this.updatePosition.cancel(),this.lazyUpdatePosition.cancel()}},{key:"updatePosition",value:function updatePosition(){this.prepareMeasure()}},{key:"lazyUpdatePosition",value:function lazyUpdatePosition(){var targetFunc=this.getTargetFunc(),affixStyle=this.state.affixStyle;if(targetFunc&&affixStyle){var offsetTop=this.getOffsetTop(),offsetBottom=this.getOffsetBottom(),targetNode=targetFunc();if(targetNode&&this.placeholderNode){var targetRect=getTargetRect(targetNode),placeholderReact=getTargetRect(this.placeholderNode),fixedTop=getFixedTop(placeholderReact,targetRect,offsetTop),fixedBottom=getFixedBottom(placeholderReact,targetRect,offsetBottom);if(void 0!==fixedTop&&affixStyle.top===fixedTop||void 0!==fixedBottom&&affixStyle.bottom===fixedBottom)return}}this.prepareMeasure()}}]),Affix}(React.Component);Affix.contextType=ConfigContext,__decorate([throttleByAnimationFrameDecorator()],Affix.prototype,"updatePosition",null),__decorate([throttleByAnimationFrameDecorator()],Affix.prototype,"lazyUpdatePosition",null);export default Affix;