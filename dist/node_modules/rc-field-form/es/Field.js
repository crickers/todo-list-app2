import"/node_modules/core-js/modules/es.promise.js";import"/node_modules/core-js/modules/es.string.includes.js";import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _objectWithoutProperties from"/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _objectSpread from"/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import _toConsumableArray from"/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import _classCallCheck from"/node_modules/@babel/runtime/helpers/esm/classCallCheck.js";import _createClass from"/node_modules/@babel/runtime/helpers/esm/createClass.js";import _assertThisInitialized from"/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js";import _inherits from"/node_modules/@babel/runtime/helpers/esm/inherits.js";import _createSuper from"/node_modules/@babel/runtime/helpers/esm/createSuper.js";import toChildrenArray from"/node_modules/rc-util/es/Children/toArray.js";import warning from"/node_modules/rc-util/es/warning.js";import React from"c:\\node_modules\\react\\index.js";import FieldContext,{HOOK_MARK}from"/node_modules/rc-field-form/es/FieldContext.js";import{toArray}from"/node_modules/rc-field-form/es/utils/typeUtil.js";import{validateRules}from"/node_modules/rc-field-form/es/utils/validateUtil.js";import{containsNamePath,defaultGetValueFromEvent,getNamePath,getValue}from"/node_modules/rc-field-form/es/utils/valueUtil.js";function requireUpdate(shouldUpdate,prev,next,prevValue,nextValue,info){return"function"==typeof shouldUpdate?shouldUpdate(prev,next,"source"in info?{source:info.source}:{}):prevValue!==nextValue}var Field=function(_React$Component){function Field(props){var _this;if(_classCallCheck(this,Field),_this=_super.call(this,props),_this.state={resetCount:0},_this.cancelRegisterFunc=null,_this.mounted=!1,_this.touched=!1,_this.dirty=!1,_this.validatePromise=null,_this.errors=[],_this.cancelRegister=function(){var _this$props=_this.props,preserve=_this$props.preserve,isListField=_this$props.isListField;_this.cancelRegisterFunc&&_this.cancelRegisterFunc(isListField,preserve),_this.cancelRegisterFunc=null},_this.getNamePath=function(){var _this$props2=_this.props,name=_this$props2.name,fieldContext=_this$props2.fieldContext,_fieldContext$prefixN=fieldContext.prefixName,prefixName=void 0===_fieldContext$prefixN?[]:_fieldContext$prefixN;return void 0===name?[]:[].concat(_toConsumableArray(prefixName),_toConsumableArray(name))},_this.getRules=function(){var _this$props3=_this.props,_this$props3$rules=_this$props3.rules,rules=void 0===_this$props3$rules?[]:_this$props3$rules,fieldContext=_this$props3.fieldContext;return rules.map(function(rule){return"function"==typeof rule?rule(fieldContext):rule})},_this.refresh=function(){_this.mounted&&_this.setState(function(_ref){var resetCount=_ref.resetCount;return{resetCount:resetCount+1}})},_this.onStoreChange=function(prevStore,namePathList,info){var _this$props4=_this.props,shouldUpdate=_this$props4.shouldUpdate,_this$props4$dependen=_this$props4.dependencies,dependencies=void 0===_this$props4$dependen?[]:_this$props4$dependen,onReset=_this$props4.onReset,store=info.store,namePath=_this.getNamePath(),prevValue=_this.getValue(prevStore),curValue=_this.getValue(store),namePathMatch=namePathList&&containsNamePath(namePathList,namePath);switch("valueUpdate"===info.type&&"external"===info.source&&prevValue!==curValue&&(_this.touched=!0,_this.dirty=!0,_this.validatePromise=null,_this.errors=[]),info.type){case"reset":if(!namePathList||namePathMatch)return _this.touched=!1,_this.dirty=!1,_this.validatePromise=null,_this.errors=[],onReset&&onReset(),void _this.refresh();break;case"setField":{if(namePathMatch){var data=info.data;return"touched"in data&&(_this.touched=data.touched),"validating"in data&&!("originRCField"in data)&&(_this.validatePromise=data.validating?Promise.resolve([]):null),"errors"in data&&(_this.errors=data.errors||[]),_this.dirty=!0,void _this.reRender()}if(shouldUpdate&&!namePath.length&&requireUpdate(shouldUpdate,prevStore,store,prevValue,curValue,info))return void _this.reRender();break}case"dependenciesUpdate":{var dependencyList=dependencies.map(getNamePath);if(dependencyList.some(function(dependency){return containsNamePath(info.relatedFields,dependency)}))return void _this.reRender();break}default:if(namePathMatch||(!dependencies.length||namePath.length||shouldUpdate)&&requireUpdate(shouldUpdate,prevStore,store,prevValue,curValue,info))return void _this.reRender();}!0===shouldUpdate&&_this.reRender()},_this.validateRules=function(options){var namePath=_this.getNamePath(),currentValue=_this.getValue(),rootPromise=Promise.resolve().then(function(){if(!_this.mounted)return[];var _this$props5=_this.props,_this$props5$validate=_this$props5.validateFirst,validateFirst=void 0!==_this$props5$validate&&_this$props5$validate,messageVariables=_this$props5.messageVariables,triggerName=(options||{}).triggerName,filteredRules=_this.getRules();triggerName&&(filteredRules=filteredRules.filter(function(rule){var validateTrigger=rule.validateTrigger;if(!validateTrigger)return!0;var triggerList=toArray(validateTrigger);return triggerList.includes(triggerName)}));var promise=validateRules(namePath,currentValue,filteredRules,options,validateFirst,messageVariables);return promise.catch(function(e){return e}).then(function(){var errors=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];_this.validatePromise===rootPromise&&(_this.validatePromise=null,_this.errors=errors,_this.reRender())}),promise});return _this.validatePromise=rootPromise,_this.dirty=!0,_this.errors=[],_this.reRender(),rootPromise},_this.isFieldValidating=function(){return!!_this.validatePromise},_this.isFieldTouched=function(){return _this.touched},_this.isFieldDirty=function(){return _this.dirty},_this.getErrors=function(){return _this.errors},_this.isListField=function(){return _this.props.isListField},_this.isList=function(){return _this.props.isList},_this.isPreserve=function(){return _this.props.preserve},_this.getMeta=function(){_this.prevValidating=_this.isFieldValidating();var meta={touched:_this.isFieldTouched(),validating:_this.prevValidating,errors:_this.errors,name:_this.getNamePath()};return meta},_this.getOnlyChild=function(children){if("function"==typeof children){var meta=_this.getMeta();return _objectSpread(_objectSpread({},_this.getOnlyChild(children(_this.getControlled(),meta,_this.props.fieldContext))),{},{isFunction:!0})}var childList=toChildrenArray(children);return 1===childList.length&&React.isValidElement(childList[0])?{child:childList[0],isFunction:!1}:{child:childList,isFunction:!1}},_this.getValue=function(store){var getFieldsValue=_this.props.fieldContext.getFieldsValue,namePath=_this.getNamePath();return getValue(store||getFieldsValue(!0),namePath)},_this.getControlled=function(){var childProps=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},_this$props6=_this.props,trigger=_this$props6.trigger,validateTrigger=_this$props6.validateTrigger,getValueFromEvent=_this$props6.getValueFromEvent,normalize=_this$props6.normalize,valuePropName=_this$props6.valuePropName,getValueProps=_this$props6.getValueProps,fieldContext=_this$props6.fieldContext,mergedValidateTrigger=void 0===validateTrigger?fieldContext.validateTrigger:validateTrigger,namePath=_this.getNamePath(),getInternalHooks=fieldContext.getInternalHooks,getFieldsValue=fieldContext.getFieldsValue,_getInternalHooks=getInternalHooks(HOOK_MARK),dispatch=_getInternalHooks.dispatch,value=_this.getValue(),originTriggerFunc=childProps[trigger],control=_objectSpread(_objectSpread({},childProps),(getValueProps||function(val){return _defineProperty({},valuePropName,val)})(value));control[trigger]=function(){_this.touched=!0,_this.dirty=!0;for(var newValue,_len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];newValue=getValueFromEvent?getValueFromEvent.apply(void 0,args):defaultGetValueFromEvent.apply(void 0,[valuePropName].concat(args)),normalize&&(newValue=normalize(newValue,value,getFieldsValue(!0))),dispatch({type:"updateValue",namePath:namePath,value:newValue}),originTriggerFunc&&originTriggerFunc.apply(void 0,args)};var validateTriggerList=toArray(mergedValidateTrigger||[]);return validateTriggerList.forEach(function(triggerName){var originTrigger=control[triggerName];control[triggerName]=function(){originTrigger&&originTrigger.apply(void 0,arguments);var rules=_this.props.rules;rules&&rules.length&&dispatch({type:"validateField",namePath:namePath,triggerName:triggerName})}}),control},props.fieldContext){var getInternalHooks=props.fieldContext.getInternalHooks,_getInternalHooks2=getInternalHooks(HOOK_MARK),initEntityValue=_getInternalHooks2.initEntityValue;initEntityValue(_assertThisInitialized(_this))}return _this}_inherits(Field,_React$Component);var _super=_createSuper(Field);return _createClass(Field,[{key:"componentDidMount",value:function componentDidMount(){var _this$props7=this.props,shouldUpdate=_this$props7.shouldUpdate,fieldContext=_this$props7.fieldContext;if(this.mounted=!0,fieldContext){var getInternalHooks=fieldContext.getInternalHooks,_getInternalHooks3=getInternalHooks(HOOK_MARK),registerField=_getInternalHooks3.registerField;this.cancelRegisterFunc=registerField(this)}!0===shouldUpdate&&this.reRender()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.cancelRegister(),this.mounted=!1}},{key:"reRender",value:function reRender(){this.mounted&&this.forceUpdate()}},{key:"render",value:function render(){var returnChildNode,resetCount=this.state.resetCount,children=this.props.children,_this$getOnlyChild=this.getOnlyChild(children),child=_this$getOnlyChild.child,isFunction=_this$getOnlyChild.isFunction;return isFunction?returnChildNode=child:React.isValidElement(child)?returnChildNode=React.cloneElement(child,this.getControlled(child.props)):(warning(!child,"`children` of Field is not validate ReactElement."),returnChildNode=child),React.createElement(React.Fragment,{key:resetCount},returnChildNode)}}]),Field}(React.Component);Field.contextType=FieldContext,Field.defaultProps={trigger:"onChange",valuePropName:"value"};function WrapperField(_ref4){var name=_ref4.name,restProps=_objectWithoutProperties(_ref4,["name"]),fieldContext=React.useContext(FieldContext),namePath=void 0===name?void 0:getNamePath(name),key="keep";return restProps.isListField||(key="_".concat((namePath||[]).join("_"))),React.createElement(Field,_extends({key:key,name:namePath},restProps,{fieldContext:fieldContext}))}export default WrapperField;