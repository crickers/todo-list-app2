import"/node_modules/core-js/modules/es.array.iterator.js";import"/node_modules/core-js/modules/es.array.reduce.js";import"/node_modules/core-js/modules/es.array.slice.js";import"/node_modules/core-js/modules/es.promise.js";import"/node_modules/core-js/modules/es.string.replace.js";import"/node_modules/core-js/modules/web.dom-collections.iterator.js";import _toConsumableArray from"/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import _defineProperty from"/node_modules/@babel/runtime/helpers/esm/defineProperty.js";import _regeneratorRuntime from"c:\\node_modules\\@babel\\runtime\\regenerator\\index.js";import _asyncToGenerator from"/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js";import _typeof from"/node_modules/@babel/runtime/helpers/esm/typeof.js";import _objectSpread from"/node_modules/@babel/runtime/helpers/esm/objectSpread2.js";import RawAsyncValidator from"/node_modules/async-validator.js";import React from"c:\\node_modules\\react\\index.js";import warning from"/node_modules/rc-util/es/warning.js";import{setValues}from"/node_modules/rc-field-form/es/utils/valueUtil.js";import{defaultValidateMessages}from"/node_modules/rc-field-form/es/utils/messages.js";var AsyncValidator=RawAsyncValidator;function replaceMessage(template,kv){return template.replace(/\$\{\w+\}/g,function(str){var key=str.slice(2,-1);return kv[key]})}function convertMessages(messages,name,rule,messageVariables){function fillTemplate(source){var target=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(source).forEach(function(ruleName){var value=source[ruleName];"string"==typeof value?target[ruleName]=replaceFunc(value,messageVariables):value&&"object"===_typeof(value)?(target[ruleName]={},fillTemplate(value,target[ruleName])):target[ruleName]=value}),target}var kv=_objectSpread(_objectSpread({},rule),{},{name:name,enum:(rule.enum||[]).join(", ")}),replaceFunc=function replaceFunc(template,additionalKV){return function(){return replaceMessage(template,_objectSpread(_objectSpread({},kv),additionalKV))}};return fillTemplate(setValues({},defaultValidateMessages,messages))}function validateRule(_x,_x2,_x3,_x4,_x5){return _validateRule.apply(this,arguments)}function _validateRule(){return _validateRule=_asyncToGenerator(_regeneratorRuntime.mark(function _callee2(name,value,rule,options,messageVariables){var cloneRule,subRuleField,validator,messages,result,subResults;return _regeneratorRuntime.wrap(function _callee2$(_context2){for(;1;)switch(_context2.prev=_context2.next){case 0:return cloneRule=_objectSpread({},rule),subRuleField=null,cloneRule&&"array"===cloneRule.type&&cloneRule.defaultField&&(subRuleField=cloneRule.defaultField,delete cloneRule.defaultField),validator=new AsyncValidator(_defineProperty({},name,[cloneRule])),messages=convertMessages(options.validateMessages,name,cloneRule,messageVariables),validator.messages(messages),result=[],_context2.prev=7,_context2.next=10,Promise.resolve(validator.validate(_defineProperty({},name,value),_objectSpread({},options)));case 10:_context2.next=15;break;case 12:_context2.prev=12,_context2.t0=_context2["catch"](7),_context2.t0.errors?result=_context2.t0.errors.map(function(_ref2,index){var message=_ref2.message;return React.isValidElement(message)?React.cloneElement(message,{key:"error_".concat(index)}):message}):(console.error(_context2.t0),result=[messages.default()]);case 15:if(result.length||!subRuleField){_context2.next=20;break}return _context2.next=18,Promise.all(value.map(function(subValue,i){return validateRule("".concat(name,".").concat(i),subValue,subRuleField,options,messageVariables)}));case 18:return subResults=_context2.sent,_context2.abrupt("return",subResults.reduce(function(prev,errors){return[].concat(_toConsumableArray(prev),_toConsumableArray(errors))},[]));case 20:return _context2.abrupt("return",result);case 21:case"end":return _context2.stop();}},_callee2,null,[[7,12]])})),_validateRule.apply(this,arguments)}export function validateRules(namePath,value,rules,options,validateFirst,messageVariables){var summaryPromise,name=namePath.join("."),filledRules=rules.map(function(currentRule){var originValidatorFunc=currentRule.validator;return originValidatorFunc?_objectSpread(_objectSpread({},currentRule),{},{validator:function validator(rule,val,callback){var hasPromise=!1,promise=originValidatorFunc(rule,val,function wrappedCallback(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];Promise.resolve().then(function(){warning(!hasPromise,"Your validator function has already return a promise. `callback` will be ignored."),hasPromise||callback.apply(void 0,args)})});hasPromise=promise&&"function"==typeof promise.then&&"function"==typeof promise.catch,warning(hasPromise,"`callback` is deprecated. Please return a promise instead."),hasPromise&&promise.then(function(){callback()}).catch(function(err){callback(err||" ")})}}):currentRule});if(!0===validateFirst)summaryPromise=new Promise(function(){var _ref=_asyncToGenerator(_regeneratorRuntime.mark(function _callee(resolve,reject){var i,errors;return _regeneratorRuntime.wrap(function _callee$(_context){for(;1;)switch(_context.prev=_context.next){case 0:i=0;case 1:if(!(i<filledRules.length)){_context.next=11;break}return _context.next=4,validateRule(name,value,filledRules[i],options,messageVariables);case 4:if(errors=_context.sent,!errors.length){_context.next=8;break}return reject(errors),_context.abrupt("return");case 8:i+=1,_context.next=1;break;case 11:resolve([]);case 12:case"end":return _context.stop();}},_callee)}));return function(_x6,_x7){return _ref.apply(this,arguments)}}());else{var rulePromises=filledRules.map(function(rule){return validateRule(name,value,rule,options,messageVariables)});summaryPromise=(validateFirst?finishOnFirstFailed(rulePromises):finishOnAllFailed(rulePromises)).then(function(errors){return errors.length?Promise.reject(errors):[]})}return summaryPromise.catch(function(e){return e}),summaryPromise}function finishOnAllFailed(_x8){return _finishOnAllFailed.apply(this,arguments)}function _finishOnAllFailed(){return _finishOnAllFailed=_asyncToGenerator(_regeneratorRuntime.mark(function _callee3(rulePromises){return _regeneratorRuntime.wrap(function _callee3$(_context3){for(;1;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",Promise.all(rulePromises).then(function(errorsList){var _ref3,errors=(_ref3=[]).concat.apply(_ref3,_toConsumableArray(errorsList));return errors}));case 1:case"end":return _context3.stop();}},_callee3)})),_finishOnAllFailed.apply(this,arguments)}function finishOnFirstFailed(_x9){return _finishOnFirstFailed.apply(this,arguments)}function _finishOnFirstFailed(){return _finishOnFirstFailed=_asyncToGenerator(_regeneratorRuntime.mark(function _callee4(rulePromises){var count;return _regeneratorRuntime.wrap(function _callee4$(_context4){for(;1;)switch(_context4.prev=_context4.next){case 0:return count=0,_context4.abrupt("return",new Promise(function(resolve){rulePromises.forEach(function(promise){promise.then(function(errors){errors.length&&resolve(errors),count+=1,count===rulePromises.length&&resolve([])})})}));case 2:case"end":return _context4.stop();}},_callee4)})),_finishOnFirstFailed.apply(this,arguments)}